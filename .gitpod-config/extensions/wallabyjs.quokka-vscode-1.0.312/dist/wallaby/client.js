/*
 * Wallaby.js - v1.0.940
 * https://wallabyjs.com
 * Copyright (c) 2014-2020 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of Wallaby.js and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
!function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[o].exports}var s="function"==typeof require&&require;module.exports=i(r[0])}({1:[function(e,t,n){global.wallabyCoreClient=!0,e("./lib/global"),delete global.wallabyCoreClient;var r=e("child_process"),i=e("path"),s=e("fs"),o=e("http"),a=e("ws"),l=0,c=/^win/.test(process.platform),u=function(){this._killed=!1,this._callbacks=Object.create(null)};u.prototype=_.extend(Object.create(EventEmitter.prototype),{start:function(t){var n=this;this._openedFiles=Object.create(null),this._killed=!1,this._forceKillProcessTimeout=t.forceKillProcessTimeout||1e3,this._nodePath=(process.env.WALLABY_NODE||"node").replace(/^~(?=$|\/|\\)/,process.env.HOME),this._useWsl="true"===process.env.WALLABY_USE_WSL&&c;var o=process.env.PATH||process.env.Path,a=_.extend({},process.env,{PATH:(o?o+i.delimiter:"")+(c?"":"/usr/local/bin"+i.delimiter+"/usr/bin")});delete a.NODE_ENV,delete a.NODE_PATH,n._withFreePort(function(o){if(!n._killed){var l=i.join(__dirname,"server.js"),c=t.projectPath,u=t.configPath,h=t.testsPath,d=t.lkp,p=t.fileName||"",f=t.editorTypeScript,g=e("os").homedir(),m=t.ol&&t.ol===!0||!1,v=n._nodePath,y=[];if(n._useWsl){var b=process.env.systemRoot+"\\system32\\wsl",T=function(e){if(!e)return e;e=e.replace(/\\/g,"/");var t=r.execSync(b+' wslpath -a "'+e+'"');return _.rtrim(t.toString(),"\n")};l=T(l),c=T(c),u=T(u),void 0!==h&&(h=T(h)),d=T(d),f=T(f),g=T(g),y.push(process.env.WALLABY_NODE||"node"),v=b}y=y.concat(["--harmony",l,"extended-core-ws","--projectCachePath="+c,"--configPath="+u,"--lkp="+d,"--client="+t.client,"--editorTypeScript="+f,"--port="+o,"--quokka="+p,"--homeDir="+g,"--cv="+t.cv,"--ol="+m]),void 0!==h&&y.push("--testsPath="+h);var k=n._normalizeDriveLetter(t.configPath&&!t.fileName?i.dirname(t.configPath):t.localRoot||t.quokkaFolder);if(!s.existsSync(k))return n.emit("notification",{type:"error",text:'Can not start Wallaby as the directory "'+k+'" does not exist.'}),void n.emit("stopped",{});n._process=r.spawn(v,y,{env:a,cwd:k}),n._process.on("error",function(e){e&&e.message&&~e.message.indexOf("spawn "+n._nodePath+" ENOENT")?(n.emit("notification",{type:"error",text:"Can not start node.js process ("+n._nodePath+'), make sure your system has <a href="https://wallabyjs.com/docs/intro/install.html#node-js">node.js installed</a>.'}),n.emit("stopped",{})):n.emit("consoleError",e.stack||e.message)}),n._bufferStream(n._process.stderr,function(e){n.emit("consoleError",e)}),n._bufferStream(n._process.stdout,function(e){e&&(~e.indexOf("wallaby.js started")||~e.indexOf("quokka.js started"))?n._connectToServer(o):n.emit("consoleLog",e)})}})},stop:function(){var e,t=this;try{e=this._process.pid;try{this._send({type:"stop"}),this._ws.close(),this._ws.removeAllListeners("close"),this._ws.removeAllListeners("error")}finally{try{this._process.disconnect()}catch(n){}setTimeout(function(){try{t._isProcessRunning(e)&&process.kill(e)}catch(n){}},t._forceKillProcessTimeout)}}catch(n){}finally{this._killed=!0,this._callbacks=Object.create(null),this._openedFiles=Object.create(null)}},_normalizeDriveLetter:function(e){return"win32"===process.platform&&e&&":"===e[1]?e.charAt(0).toUpperCase()+e.slice(1):e},_isProcessRunning:function(e){try{return process.kill(e,0)}catch(t){return"EPERM"===t.code}},_connectToServer:function(e,t){var n=this;t=t||"localhost",n._ws=new a("ws://"+t+":"+e),n._ws.on("message",function(e){var t=JSON.parse(e),r=n["_"+t.type];r&&r.call(n,t)}),n._ws.on("close",function(e,t){console.log("Disconnected from wallaby core: "+e+(t?", "+t:""))}),n._ws.on("error",function(){n._connectToServer(e,"127.0.0.1")})},_withFreePort:function(e){var t=o.createServer();t.listen(0),t.on("listening",function(){var n=t.address().port;t.once("close",function(){e(n)}),t.close()}),process.nextTick(function(){})},isDisposed:function(){return this._killed},fileChangedInEditor:function(e,t,n,r){this._send({type:"fileChangedInEditor",path:e,content:t,changeFrame:n,transientChange:r})},fileOpenedInEditor:function(e){this._openedFiles[e]=(this._openedFiles[e]||0)+1,this._send({type:"fileOpenedInEditor",path:e})},fileClosedInEditor:function(e){var t=(this._openedFiles[e]||0)-1;this._openedFiles[e]=t,t<0&&console.log("Negative opened editor count for "+e),0===t&&(delete this._openedFiles[e],this._send({type:"fileClosedInAllEditors",path:e}))},expressionsToEvaluate:function(e){this._send({type:"expressionsToEvaluate",request:{expressionsToEvaluate:e}})},traceContext:function(e){this._send({type:"traceContext",request:e})},copyToClipboard:function(e){this._send({type:"copyToClipboard",request:{data:e}})},evaluateExpressionInEditor:function(e,t,n,r){this._send({type:"evaluateExpressionInEditor",path:e,content:t,range:n,action:r})},copyDiagnosticsReportToClipboard:function(e){this._send({type:"copyDiagnosticsReportToClipboard",data:e})},editorDataEvent:function(e){this._send({type:"editorDataEvent",data:e})},muteNotification:function(e){this._send({type:"muteNotification",request:e})},runTests:function(e){this._send({type:"runTests",request:e})},toggleTestFilter:function(e){this._send({type:"toggleTestFilter",request:e})},setTestLocations:function(e){this._send({type:"setTestLocations",paths:e})},addTestLocations:function(e){this._send({type:"addTestLocations",paths:e})},removeTestLocations:function(e){this._send({type:"removeTestLocations",paths:e})},getFileMessages:function(e){this._send({type:"getFileMessages",request:e})},continueTrial:function(){this._send({type:"continueTrial"})},setRunMode:function(e){this._send({type:"runMode",request:{mode:e}})},requestUncoveredRegions:function(e,t){this._requestWithCorrelationId("uncoveredRegions",e,t)},requestLineReport:function(e,t){this._requestWithCorrelationId("lineReport",e,t)},requestLocation:function(e,t){this._requestWithCorrelationId("location",e,t)},requestSnapshot:function(e,t){this._requestWithCorrelationId("snapshot",e,t)},requestInstrumentedFile:function(e,t){this._requestWithCorrelationId("instrumentedFile",e,t)},requestError:function(e,t){this._requestWithCorrelationId("error",e,t)},requestTrace:function(e,t){this._requestWithCorrelationId("trace",e,t)},requestTestTimeline:function(e,t){this._requestWithCorrelationId("testTimeline",e,t)},requestTests:function(e,t){this._requestWithCorrelationId("tests",e,t)},_requestWithCorrelationId:function(e,t,n){var r=this,i=++l,s=this._callbacks[i]={done:n};this._send({type:e,request:t,id:i}),s.timeout=setTimeout(function(){delete r._callbacks[i]},5e3)},_responseWithCorrelationId:function(e){var t=this._callbacks[e.id];delete this._callbacks[e.id],t&&(clearTimeout(t.timeout),t.done(e.data))},_bufferStream:function(e,t){var n=this,r="";e.setEncoding("utf8"),e.on("data",function(e){if(!n._killed){r+=e;var i=r.lastIndexOf("\n");~i&&(t(r.substring(0,i+1)),r=r.substring(i+1))}}),e.on("close",function(){n._killed||r.length&&t(r)})},_send:function(e){this._ws&&this._ws.send(JSON.stringify(e))},_started:function(e){this.emit("started",e)},_stopped:function(e){this.emit("stopped",e)},_configChanged:function(e){this.emit("configChanged",e)},_expiredLicense:function(e){this.emit("expiredLicense",e)},_documentUpdates:function(e){e.updates=e.updates||{},e.updates.hasRunError=e.hasRunError,e.updates.hasGlobalError=e.hasGlobalError,this.emit("documentUpdates",e.updates)},_navigationRequested:function(e){this.emit("navigationRequested",e)},_stats:function(e){this.emit("stats",e.data)},_filesToTrack:function(e){this.emit("filesToTrack",e.files)},_fileMessages:function(e){this.emit("fileMessages",e)},_live:function(e){this.emit("live",e)},_projectConfigured:function(e){this.emit("projectConfigured",e)},_notification:function(e){this.emit("notification",e.notification)},_consoleOutput:function(e){this.emit("consoleOutput",e.messages)},_busy:function(){this.emit("busy")},_copyToClipboard:function(e){this.emit("copyToClipboard",e)},_traceNavigationReset:function(){this.emit("traceNavigationReset")},_traceNavigated:function(e){this.emit("traceNavigated",e)},_traceTestSelectionRequested:function(e){this.emit("traceTestSelectionRequested",e)},_testFilterTestSelectionRequested:function(e){this.emit("testFilterTestSelectionRequested",e)},_location:function(e){this._responseWithCorrelationId(e)},_snapshot:function(e){this._responseWithCorrelationId(e)},_error:function(e){this._responseWithCorrelationId(e)},_uncoveredRegions:function(e){this._responseWithCorrelationId(e)},_tests:function(e){this._responseWithCorrelationId(e)},_lineReport:function(e){this._responseWithCorrelationId(e)},_instrumentedFile:function(e){this._responseWithCorrelationId(e)},_testFilterToggled:function(e){this.emit("testFilterToggled",e)},_trace:function(e){this._responseWithCorrelationId(e)},_testTimeline:function(e){this._responseWithCorrelationId(e)},_testTimelineReset:function(){this.emit("testTimelineReset")},_activeTestFileCoverageChanged:function(e){this.emit("activeTestFileCoverageChanged",e)}}),t.exports={Session:u,enums:e("./lib/extension/shared/enums"),utils:e("./lib/extension/shared/utils"),reportBuilder:e("./lib/extension/client/reportBuilder"),dmp:new(e("./lib/diffMatchPatch"))}},{"./lib/diffMatchPatch":4,"./lib/extension/client/reportBuilder":6,"./lib/extension/shared/enums":7,"./lib/extension/shared/utils":8,"./lib/global":10,child_process:void 0,fs:void 0,http:void 0,os:void 0,path:void 0,ws:void 0}],2:[function(e,t,n){var r=e("path"),i=e("compression"),s=e("graceful-fs"),o=e("express"),a=e("./fileCacheMiddleware"),l=e("./utils"),c=s.readFileSync(r.join(__dirname,"runners","browser","sandbox.html")).toString(),u="__wallaby__",h=logger.create("browserRunner").debug,d=function(e,t){var n=this;n._project=e,n._workerPool=t,n._baseDir=n._project._instrumentedRoot+r.sep,n._initializer=e.settings().bootstrap,n._reportUnhandledPromises=!!e.settings().reportUnhandledPromises,n._throwOnBeforeunload=!!e.settings().throwOnBeforeUnload,n._maxLogEntrySize=e.settings().maxLogEntrySize,n._sandboxHtml={},n._report404AsError=e.settings().env.report404AsError,n._lruCache=n._project._lruCache,n._wallabyFileIdPrefix=n._workerPool.wallabyFileIdPrefix(),n._app=o(),n._app.use(i({filter:function(e){return~e.url.indexOf("____wallaby-bundle")}})),n._app.use("/wallaby_sandbox:id.html",function(e,t){t.send(n._sandboxHtml[e.params.id])}),e.settings().testFramework.path&&n._app.use("/"+u+"/"+e.settings().testFramework.version+"/framework.js",a.create({main:{root:r.join(e._localRoot,e.settings().testFramework.path)}})),n._app.use("/"+u+"/tracer.js",a.create({main:{root:r.join(__dirname,"tracer.js")}})),n._app.use("/"+u,a.create({main:{root:r.join(__dirname,"runners","browser")}})),e.settings().middleware(n._app,o),n._project.isNativeBundler()?n._app.use(a.create({main:{root:n._baseDir,cache:n._lruCache},alt:{root:n._project._localProjectDir,read:function(e,t){var i=l.normalizePath(r.relative(n._project._localProjectDir,e));n._project.idByPath(i)?n._project.getLatestOriginalFileContentByPathAsync(i).then(function(e){return t(null,e)})["catch"](function(e){return t(e)}):t(new Error("File '"+i+"' is not registered."))}}},n._report404AsError)):n._app.use(a.create({main:{root:n._baseDir,cache:n._lruCache}},n._report404AsError))};d.prototype={prepareSandbox:function(e,t,n){var r=this;e.allFilesHash=_.reduce(e.allFiles.concat(e.allTestFiles),function(e,t){return e[t.normalizedRelativePath]={ts:t.ts,id:t.tmp&&t.originalId?t.originalId:t.id},e},{});var i=e.allFiles.concat(e.allTestFiles),s=e.filesToLoad.concat(e.testFilesToLoad),o=_.reduce(e.testFilesToLoad,function(e,t){return e[t.id]=t,e},{});h("Total files to load in sandbox: "+s.length);var a=r._workerPool.receiverPort(),d=l.isWsl()?"localhost":"127.0.0.1";r._anyIncludedEsm=!1;var p=r._project.isNativeBundler();r._sandboxHtml[n]=c.replace("<inject/>",function(){return _.reduce(i,function(e,t){return e+(_.isNumber(t.id)?"file = window.$_$coverage["+t.id+"]=[]; for(i=0, len="+t.rangesLength+"; i < len; i++) file[i] = {};":"")},"<script>(function() {window.$_$receiverPort = "+a+";window.$_$receiverHost = '"+d+"';window.$_$session=\""+t+'";window.$_$baseDir='+JSON.stringify(p?r._project._localProjectDir:r._baseDir)+";window.$_$initialSpecId="+1e5*(n+1)+";window.$_$reportUnhanledPromises="+r._reportUnhandledPromises+";window.$_$throwOnBeforeunload="+r._throwOnBeforeunload+";window.$_$maxLogEntrySize="+r._maxLogEntrySize+";window.$_$traceContext="+JSON.stringify(r._workerPool.traceContext())+";window.$_$coverage=[]; var file, i, len;")+"window.$_$slow="+r._project.settings().slowTestThreshold+";window.$_$expressionsToEvaluate="+JSON.stringify(e.expressionsToEvaluate)+";window.$_$files="+JSON.stringify(e.allFilesHash)+";window.$_$tests="+(e.tests?JSON.stringify(e.tests):"null")+";window.$_$testFiles="+JSON.stringify(_.chain(e.allTestFiles).filter(function(e){return!e.shadowed}).map(function(t){return{path:p?t.normalizedRelativePath:t.relativePath,loaded:t.include&&!!o[t.id],id:(e.allFilesHash[t.normalizedRelativePath]||{}).id}}).value())+';})();</script><script src="'+u+'/tracer.js"></script><script src="'+u+"/"+e.framework.version+'/framework.js"></script><script src="'+u+"/"+e.framework.configurator+'/configurator.js"></script><script src="'+u+"/"+e.framework.reporter+'/reporter.js"></script>'+_.reduce(s,function(e,t){r._anyIncludedEsm=r._anyIncludedEsm||t.esm;var n=t.tmp,i=t.ts+(n?t.originalId?r._wallabyFileIdPrefix+t.originalId:"":r._wallabyFileIdPrefix+t.id);switch(t.type){case"js":case"mjs":case"jsx":case"es6":case"es7":return e+"<script "+(t.esm?'type="module"':"")+' src="'+t.normalizedRelativePath+"?"+i+'"></script>';case"html":case"htm":return e+'<link href="'+t.normalizedRelativePath+"?"+t.ts+'" rel="import">';case"css":return e+'<link rel="stylesheet" type="text/css" href="'+t.normalizedRelativePath+"?"+i+'"></link>';default:return e}},"")+(r._initializer&&i.length?"<script>("+r._initializer+")(window.wallaby);</script>":"")+"<script "+(r._anyIncludedEsm?'type="module"':"")+' src="'+u+"/"+e.framework.starter+'/starter.js"></script>'});var f=r.sandboxRootUrl()+"wallaby_sandbox"+n+".html";return h("Sandbox is generated [%s]: %s",r.sandboxName(n,t),f),Q.when(f)},doesSandboxContainESModules:function(){return this._anyIncludedEsm},sandboxRootUrl:function(){return this._sandboxRootUrl?this._sandboxRootUrl:(this._sandboxRootUrl="http://localhost:"+this._workerPool.receiverPort()+"/",this._sandboxRootUrl)},webApp:function(){return this._app},sandboxName:function(e,t){return"worker #"+e+", session #"+t}},t.exports=d},{"./fileCacheMiddleware":9,"./utils":16,compression:void 0,express:void 0,"graceful-fs":void 0,path:void 0}],3:[function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r["throw"](e))}catch(t){s(t)}}function l(e){e.done?n(e.value):i(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,s&&(o=2&n[0]?s["return"]:n[0]?s["throw"]||((o=s["return"])&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,s=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},s=e("chrome-launcher"),o=e("chrome-remote-interface"),a=e("./runWorkerPool"),l=e("./browserEnvironment"),c=e("net"),u=e("./utils"),h=logger.create("chromeRunner").debug;s.Launcher.prototype.isDebuggerReady=function(){var e=this;return new Promise(function(t,n){var r;r=u.isWsl()?c.createConnection(e.port,u.wslHostIpAddress()):c.createConnection(e.port),r.once("error",function(t){e.cleanup(r),n(t)}),r.once("connect",function(){e.cleanup(r),t()})})};var d=function(){function t(e){this._screenShotReady=Promise.resolve(),this._project=e;var t=e.settings().env;this._path=t.runner,t.params&&t.params.runner&&(this._flags=t.params.runner.split(" ")),t.keepTabsOpened&&(this._keepTabsOpened=t.keepTabsOpened),this._chromePromise=this._launchChromeInstance(),this._workerPool=new a(this._project,{create:_.bind(this._create,this),recycle:_.bind(this._recycle,this),healthy:function(){return!0},prepare:_.bind(this._prepareTab,this)}),this._browserEnvironment=new l(e,this._workerPool)}return t.prototype.run=function(e){return this._workerPool.run(e)},t.prototype.cancel=function(e){return this._workerPool.cancel(e)},t.prototype.start=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this._workerPool.start(this._browserEnvironment.webApp())];case 1:return e=t.sent(),this._workerPool.setFileRoot(this._browserEnvironment.sandboxRootUrl()),[2,e]}})})},t.prototype.stop=function(){if(this._workerPool.stop(),this._chrome)try{process.kill(this._chrome.pid)}catch(e){}},t.prototype._create=function(e,t){return r(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return[4,this._chromePromise];case 1:return n.sent(),t({workerId:e}),[2]}})})},t.prototype._recycle=function(e){this._closeTab(e)},t.prototype._prepareTab=function(t,n){return r(this,void 0,void 0,function(){var r,s,o,a,l;return i(this,function(i){switch(i.label){case 0:return r=this,s=_.randomId(),o=this._browserEnvironment.sandboxName(n,s),h("Starting sandbox [%s]",o),[4,this._workerPool.getWorker(n)];case 1:return a=i.sent(),this._checkCancelled(),h("Preparing sandbox [%s]",o),[4,this._browserEnvironment.prepareSandbox(t,s,n)];case 2:return l=i.sent(),this._checkCancelled(),h("Prepared sandbox [%s]",o),[2,{name:o,sessionId:s,workerId:n,instance:{resume:function(){r._evaluateOnTab(a.client,function(){$_$tracer.resume()})},ping:function(e){r._evaluateOnTab(a.client,function(){},e)},close:function(){if(t.screen){var e={client:a&&a.client};a&&delete a.client,r._screenShotReady.then(function(){r._closeTab(e)})}else r._closeTab(a)},closing:function(){try{t.screen&&(r._screenShotReady=a.client.Page.captureScreenshot().then(function(n){var r=new Buffer(n.data,"base64");e("fs").writeFileSync(t.screen,r,"base64")}))}catch(n){r._screenShotReady=Promise.resolve()}},start:function(e){r._openTab(a,l,function(t){e(t.status)&&r._evaluateOnTab(a.client,function(){$_$tracer.start()})})}}}]}})})},t.prototype._checkCancelled=function(){if(this._workerPool.cancelled())throw{runCancelled:!0}},t.prototype._connectionOptions=function(e){void 0===e&&(e={});var t=u.isWsl()?u.wslHostIpAddress():"127.0.0.1";return _.extend({port:this._chrome.port,host:t},e)},t.prototype._evaluateOnTab=function(e,t,n){return void 0===n&&(n=_.noop),r(this,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e.Runtime?[4,e.Runtime.evaluate({expression:"("+t.toString()+")()"})]:[2];case 1:return i.sent(),n(),[3,3];case 2:return r=i.sent(),h("Failed to evaluate code on Chrome Tab: "+r.message),[3,3];case 3:return[2]}})})},t.prototype._openTab=function(e,t,n){return void 0===n&&(n=_.noop),r(this,void 0,void 0,function(){var r,s,a,l,c,u,h,d,p,f,_=this;return i(this,function(i){switch(i.label){case 0:if(i.trys.push([0,18,,19]),!this._chrome)throw new Error("Chrome is not running");return[4,o.New(this._connectionOptions({url:t}))];case 1:return r=i.sent(),e.client={target:{id:r.id}},this._checkCancelled(),[4,o({tab:r})];case 2:s=i.sent(),e.client=s,this._checkCancelled(),a=s.Page,l=s.Network,i.label=3;case 3:return i.trys.push([3,16,,17]),c=!!this._browserEnvironment.doesSandboxContainESModules(),u=[a.enable()],c&&u.push(l.enable()),[4,Promise.all(u)];case 4:if(i.sent(),this._checkCancelled(),!c)return[3,13];l.requestIntercepted(function(e){var t=e.interceptionId,n=e.request;return l.continueInterceptedRequest({interceptionId:t,url:_._updateTrackedFileUrlIfRequired(n.url)})["catch"](function(e){})}),i.label=5;case 5:return i.trys.push([5,7,,12]),[4,s.send("Network.setRequestInterception",{patterns:[{urlPattern:"*"}]})];case 6:return i.sent(),[3,12];case 7:h=i.sent(),i.label=8;case 8:return i.trys.push([8,10,,11]),[4,l.setRequestInterceptionEnabled({enabled:!0})];case 9:return i.sent(),[3,11];case 10:return d=i.sent(),console.warn("Unable to configure network request interception in Chrome"),[3,11];case 11:return[3,12];case 12:this._checkCancelled(),i.label=13;case 13:return[4,a.navigate({url:t})];case 14:return i.sent(),this._checkCancelled(),[4,a.loadEventFired()];case 15:return i.sent(),this._checkCancelled(),n({status:"success"}),[3,17];case 16:return p=i.sent(),this._closeTab(e),n({status:"failed: "+(p.message||"unknown")}),[3,17];case 17:return[3,19];case 18:return f=i.sent(),n({status:"failed: "+(f.message||"unknown")}),[3,19];case 19:return[2]}})})},t.prototype._closeTab=function(e){return r(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:if(!e||!e.client)return[3,6];t=e.client,delete e.client,r.label=1;case 1:return r.trys.push([1,4,,5]),this._keepTabsOpened?[3,3]:[4,o.Close(this._connectionOptions({id:t.target.id}))];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:return n=r.sent(),h("Failed to close Chrome Tab: "+n.message),[3,5];case 5:try{t.close()}catch(i){h("Failed to close Chrome Tab client: "+i.message)}r.label=6;case 6:return[2]}})})},t.prototype._launchChromeInstance=function(){return r(this,void 0,void 0,function(){var t,n,r,o,a;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=["--headless","--disable-gpu","--deterministic-fetch"],n=e("os"),"Linux"!==n.type()||u.isWsl()||(t.push("--no-sandbox"),t.push("--disable-setuid-sandbox")),r=this._flags||t,u.isWsl()&&r.push("--remote-debugging-address="+u.wslHostIpAddress()),o=this,[4,s.launch({chromeFlags:r,chromePath:this._path,logLevel:"silent"})];case 1:return o._chrome=i.sent(),[3,3];case 2:return a=i.sent(),this._handleHostError(a),[3,3];case 3:return[2]}})})},t.prototype._updateTrackedFileUrlIfRequired=function(e){if(!e||~e.indexOf("wallabyFileId")||~e.indexOf("__wallaby__"))return e;var t=e;if(t=t.replace(this._browserEnvironment.sandboxRootUrl(),""),t===e)return e;var n=t.lastIndexOf("?");n>=0&&(t=t.substring(0,n));var r=t&&this._project.getFileMetadataByPath(t);return r?e+(~n?"&":"?")+r.changeTs+"&wallabyFileId="+r.id:e},t.prototype._handleHostError=function(e){e=e||{},this._project._cleanStack(e);var t="Chrome runner error: "+(e.message||"unknown"),n=e.stack||t;console.error(n),this._project._emitTestRunError(t)},t}();t.exports=d},{"./browserEnvironment":2,"./runWorkerPool":15,"./utils":16,"chrome-launcher":void 0,"chrome-remote-interface":void 0,fs:void 0,net:void 0,os:void 0}],4:[function(e,t,n){function r(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var i=-1,s=1,o=0;r.Diff,r.prototype.diff_main=function(e,t,n,r){"undefined"==typeof r&&(r=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var i=r;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[o,e]]:[];"undefined"==typeof n&&(n=!0);var s=n,a=this.diff_commonPrefix(e,t),l=e.substring(0,a);e=e.substring(a),t=t.substring(a),a=this.diff_commonSuffix(e,t);var c=e.substring(e.length-a);e=e.substring(0,e.length-a),t=t.substring(0,t.length-a);var u=this.diff_compute_(e,t,s,i);return l&&u.unshift([o,l]),c&&u.push([o,c]),this.diff_cleanupMerge(u),u},r.prototype.diff_compute_=function(e,t,n,r){var a;if(!e)return[[s,t]];if(!t)return[[i,e]];var l=e.length>t.length?e:t,c=e.length>t.length?t:e,u=l.indexOf(c);if(u!=-1)return a=[[s,l.substring(0,u)],[o,c],[s,l.substring(u+c.length)]],e.length>t.length&&(a[0][0]=a[2][0]=i),a;if(1==c.length)return[[i,e],[s,t]];var h=this.diff_halfMatch_(e,t);if(h){var d=h[0],p=h[1],f=h[2],_=h[3],g=h[4],m=this.diff_main(d,f,n,r),v=this.diff_main(p,_,n,r);return m.concat([[o,g]],v)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,r):this.diff_bisect_(e,t,r)},r.prototype.diff_lineMode_=function(e,t,n){var r=this.diff_linesToChars_(e,t);e=r.chars1,t=r.chars2;var a=r.lineArray,l=this.diff_main(e,t,!1,n);this.diff_charsToLines_(l,a),this.diff_cleanupSemantic(l),l.push([o,""]);for(var c=0,u=0,h=0,d="",p="";c<l.length;){switch(l[c][0]){case s:h++,p+=l[c][1];break;case i:u++,d+=l[c][1];break;case o:if(u>=1&&h>=1){l.splice(c-u-h,u+h),c=c-u-h;for(var r=this.diff_main(d,p,!1,n),f=r.length-1;f>=0;f--)l.splice(c,0,r[f]);c+=r.length}h=0,u=0,d="",p=""}c++}return l.pop(),l},r.prototype.diff_bisect_=function(e,t,n){for(var r=e.length,o=t.length,a=Math.ceil((r+o)/2),l=a,c=2*a,u=new Array(c),h=new Array(c),d=0;d<c;d++)u[d]=-1,h[d]=-1;u[l+1]=0,h[l+1]=0;for(var p=r-o,f=p%2!=0,_=0,g=0,m=0,v=0,y=0;y<a&&!((new Date).getTime()>n);y++){for(var b=-y+_;b<=y-g;b+=2){var T,k=l+b;T=b==-y||b!=y&&u[k-1]<u[k+1]?u[k+1]:u[k-1]+1;for(var w=T-b;T<r&&w<o&&e.charAt(T)==t.charAt(w);)T++,w++;if(u[k]=T,T>r)g+=2;else if(w>o)_+=2;else if(f){var S=l+p-b;if(S>=0&&S<c&&h[S]!=-1){var x=r-h[S];if(T>=x)return this.diff_bisectSplit_(e,t,T,w,n)}}}for(var C=-y+m;C<=y-v;C+=2){var x,S=l+C;x=C==-y||C!=y&&h[S-1]<h[S+1]?h[S+1]:h[S-1]+1;for(var F=x-C;x<r&&F<o&&e.charAt(r-x-1)==t.charAt(o-F-1);)x++,F++;if(h[S]=x,x>r)v+=2;else if(F>o)m+=2;else if(!f){var k=l+p-C;if(k>=0&&k<c&&u[k]!=-1){var T=u[k],w=l+T-k;if(x=r-x,T>=x)return this.diff_bisectSplit_(e,t,T,w,n)}}}}return[[i,e],[s,t]]},r.prototype.diff_bisectSplit_=function(e,t,n,r,i){var s=e.substring(0,n),o=t.substring(0,r),a=e.substring(n),l=t.substring(r),c=this.diff_main(s,o,!1,i),u=this.diff_main(a,l,!1,i);return c.concat(u)},r.prototype.diff_linesToChars_=function(e,t){function n(e){for(var t="",n=0,s=-1,o=r.length;s<e.length-1;){s=e.indexOf("\n",n),s==-1&&(s=e.length-1);var a=e.substring(n,s+1);n=s+1,(i.hasOwnProperty?i.hasOwnProperty(a):void 0!==i[a])?t+=String.fromCharCode(i[a]):(t+=String.fromCharCode(o),i[a]=o,r[o++]=a)}return t}var r=[],i={};r[0]="";var s=n(e),o=n(t);return{chars1:s,chars2:o,lineArray:r}},r.prototype.diff_wordMode=function(e,t){var n=this.diff_linesToWords_(e,t),r=n.chars1,i=n.chars2,s=n.lineArray,o=this.diff_main(r,i,!1);return this.diff_charsToLines_(o,s),o},r.prototype.diff_linesToWords_=function(e,t){function n(e){for(var t=e.split(/(\s+|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&o.test(t[n])&&o.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t}function r(e){for(var t="",r=n(e),o=i.length,a=0,l=r.length;a<l;a++){var c=r[a];(s.hasOwnProperty?s.hasOwnProperty(c):void 0!==s[c])?t+=String.fromCharCode(s[c]):(t+=String.fromCharCode(o),s[c]=o,i[o++]=c)}return t}var i=[],s={};i[0]="";var o=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,a=r(e),l=r(t);return{chars1:a,chars2:l,lineArray:i}},r.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var r=e[n][1],i=[],s=0;s<r.length;s++)i[s]=t[r.charCodeAt(s)];e[n][1]=i.join("")}},r.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,s=0;n<i;)e.substring(s,i)==t.substring(s,i)?(n=i,s=n):r=i,i=Math.floor((r-n)/2+n);return i},r.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,s=0;n<i;)e.substring(e.length-i,e.length-s)==t.substring(t.length-i,t.length-s)?(n=i,s=n):r=i,i=Math.floor((r-n)/2+n);return i},r.prototype.diff_commonOverlap_=function(e,t){var n=e.length,r=t.length;if(0==n||0==r)return 0;n>r?e=e.substring(n-r):n<r&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;for(var s=0,o=1;;){var a=e.substring(i-o),l=t.indexOf(a);if(l==-1)return s;o+=l,0!=l&&e.substring(i-o)!=t.substring(0,o)||(s=o,o++)}},r.prototype.diff_halfMatch_=function(e,t){function n(e,t,n){for(var r,i,s,a,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,u="";(c=t.indexOf(l,c+1))!=-1;){var h=o.diff_commonPrefix(e.substring(n),t.substring(c)),d=o.diff_commonSuffix(e.substring(0,n),t.substring(0,c));u.length<d+h&&(u=t.substring(c-d,c)+t.substring(c,c+h),r=e.substring(0,n-d),i=e.substring(n+h),s=t.substring(0,c-d),a=t.substring(c+h))}return 2*u.length>=e.length?[r,i,s,a,u]:null}if(this.Diff_Timeout<=0)return null;var r=e.length>t.length?e:t,i=e.length>t.length?t:e;if(r.length<4||2*i.length<r.length)return null;var s,o=this,a=n(r,i,Math.ceil(r.length/4)),l=n(r,i,Math.ceil(r.length/2));if(!a&&!l)return null;s=l?a&&a[4].length>l[4].length?a:l:a;var c,u,h,d;e.length>t.length?(c=s[0],u=s[1],h=s[2],d=s[3]):(h=s[0],d=s[1],c=s[2],u=s[3]);var p=s[4];return[c,u,h,d,p]},r.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],r=0,a=null,l=0,c=0,u=0,h=0,d=0;l<e.length;)e[l][0]==o?(n[r++]=l,c=h,u=d,h=0,d=0,a=e[l][1]):(e[l][0]==s?h+=e[l][1].length:d+=e[l][1].length,a&&a.length<=Math.max(c,u)&&a.length<=Math.max(h,d)&&(e.splice(n[r-1],0,[i,a]),e[n[r-1]+1][0]=s,r--,r--,l=r>0?n[r-1]:-1,c=0,u=0,h=0,d=0,a=null,t=!0)),l++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),l=1;l<e.length;){if(e[l-1][0]==i&&e[l][0]==s){var p=e[l-1][1],f=e[l][1],_=this.diff_commonOverlap_(p,f),g=this.diff_commonOverlap_(f,p);_>=g?(_>=p.length/2||_>=f.length/2)&&(e.splice(l,0,[o,f.substring(0,_)]),e[l-1][1]=p.substring(0,p.length-_),e[l+1][1]=f.substring(_),l++):(g>=p.length/2||g>=f.length/2)&&(e.splice(l,0,[o,p.substring(0,g)]),e[l-1][0]=s,e[l-1][1]=f.substring(0,f.length-g),e[l+1][0]=i,e[l+1][1]=p.substring(g),l++),l++}l++}},r.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),i=t.charAt(0),s=n.match(r.nonAlphaNumericRegex_),o=i.match(r.nonAlphaNumericRegex_),a=s&&n.match(r.whitespaceRegex_),l=o&&i.match(r.whitespaceRegex_),c=a&&n.match(r.linebreakRegex_),u=l&&i.match(r.linebreakRegex_),h=c&&e.match(r.blanklineEndRegex_),d=u&&t.match(r.blanklineStartRegex_);return h||d?5:c||u?4:s&&!a&&l?3:a||l?2:s||o?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==o&&e[n+1][0]==o){var i=e[n-1][1],s=e[n][1],a=e[n+1][1],l=this.diff_commonSuffix(i,s);if(l){var c=s.substring(s.length-l);i=i.substring(0,i.length-l),s=c+s.substring(0,s.length-l),a=c+a}for(var u=i,h=s,d=a,p=t(i,s)+t(s,a);s.charAt(0)===a.charAt(0);){i+=s.charAt(0),s=s.substring(1)+a.charAt(0),a=a.substring(1);var f=t(i,s)+t(s,a);f>=p&&(p=f,u=i,h=s,d=a)}e[n-1][1]!=u&&(u?e[n-1][1]=u:(e.splice(n-1,1),n--),e[n][1]=h,d?e[n+1][1]=d:(e.splice(n+1,1),n--))}n++}},r.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,r.whitespaceRegex_=/\s/,r.linebreakRegex_=/[\r\n]/,r.blanklineEndRegex_=/\n\r?\n$/,r.blanklineStartRegex_=/^\r?\n\r?\n/,r.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],r=0,a=null,l=0,c=!1,u=!1,h=!1,d=!1;l<e.length;)e[l][0]==o?(e[l][1].length<this.Diff_EditCost&&(h||d)?(n[r++]=l,c=h,u=d,a=e[l][1]):(r=0,a=null),h=d=!1):(e[l][0]==i?d=!0:h=!0,a&&(c&&u&&h&&d||a.length<this.Diff_EditCost/2&&c+u+h+d==3)&&(e.splice(n[r-1],0,[i,a]),e[n[r-1]+1][0]=s,r--,a=null,c&&u?(h=d=!0,r=0):(r--,l=r>0?n[r-1]:-1,h=d=!1),t=!0)),l++;t&&this.diff_cleanupMerge(e)},r.prototype.diff_cleanupMerge=function(e){e.push([o,""]);for(var t,n=0,r=0,a=0,l="",c="";n<e.length;)switch(e[n][0]){
case s:a++,c+=e[n][1],n++;break;case i:r++,l+=e[n][1],n++;break;case o:r+a>1?(0!==r&&0!==a&&(t=this.diff_commonPrefix(c,l),0!==t&&(n-r-a>0&&e[n-r-a-1][0]==o?e[n-r-a-1][1]+=c.substring(0,t):(e.splice(0,0,[o,c.substring(0,t)]),n++),c=c.substring(t),l=l.substring(t)),t=this.diff_commonSuffix(c,l),0!==t&&(e[n][1]=c.substring(c.length-t)+e[n][1],c=c.substring(0,c.length-t),l=l.substring(0,l.length-t))),0===r?e.splice(n-a,r+a,[s,c]):0===a?e.splice(n-r,r+a,[i,l]):e.splice(n-r-a,r+a,[i,l],[s,c]),n=n-r-a+(r?1:0)+(a?1:0)+1):0!==n&&e[n-1][0]==o?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,a=0,r=0,l="",c=""}""===e[e.length-1][1]&&e.pop();var u=!1;for(n=1;n<e.length-1;)e[n-1][0]==o&&e[n+1][0]==o&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),u=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),u=!0)),n++;u&&this.diff_cleanupMerge(e)},r.prototype.diff_xIndex=function(e,t){var n,r=0,o=0,a=0,l=0;for(n=0;n<e.length&&(e[n][0]!==s&&(r+=e[n][1].length),e[n][0]!==i&&(o+=e[n][1].length),!(r>t));n++)a=r,l=o;return e.length!=n&&e[n][0]===i?l:l+(t-a)},r.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,r=/</g,a=/>/g,l=/\n/g,c=0;c<e.length;c++){var u=e[c][0],h=e[c][1],d=h.replace(n,"&amp;").replace(r,"&lt;").replace(a,"&gt;").replace(l,"&para;<br>");switch(u){case s:t[c]='<ins style="background:#e6ffe6;">'+d+"</ins>";break;case i:t[c]='<del style="background:#ffe6e6;">'+d+"</del>";break;case o:t[c]="<span>"+d+"</span>"}}return t.join("")},r.prototype.diff_prettyCompactHtml=function(e){for(var t=[],n=0;n<e.length;n++){var r=0===n,a=n===e.length-1,l=e[n][0],c=e[n][1];switch(l){case s:t[n]='<ins style="background:#e6ffe6;">'+this.prepare_text_(c)+"</ins>";break;case i:t[n]='<del style="background:#ffe6e6;">'+this.prepare_text_(c)+"</del>";break;case o:t[n]="<span>"+this.truncate_context_(c,r,a)+"</span>"}}return t.join("")},r.prototype.prepare_text_=function(e){var t=/&/g,n=/</g,r=/>/g,i=/\n/g;return e.replace(t,"&amp;").replace(n,"&lt;").replace(r,"&gt;").replace(i,"&para;<br>")},r.prototype.truncate_context_=function(e,t,n){var r=e.split(/\r\n|\r|\n/),i='<span class="dots">...</span>',s=r.length,o=4;return s<=o?this.prepare_text_(e):!t&&!n&&s<=2*o?this.prepare_text_(e):t?i+this.prepare_text_("\n"+r.slice(-o).join("\n")):n?this.prepare_text_(r.slice(0,o).join("\n")+"\n")+i:this.prepare_text_(r.slice(0,o).join("\n")+"\n")+i+this.prepare_text_("\n"+r.slice(-o).join("\n"))},r.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==s&&(t[n]=e[n][1]);return t.join("")},r.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==i&&(t[n]=e[n][1]);return t.join("")},r.prototype.diff_levenshtein=function(e){for(var t=0,n=0,r=0,a=0;a<e.length;a++){var l=e[a][0],c=e[a][1];switch(l){case s:n+=c.length;break;case i:r+=c.length;break;case o:t+=Math.max(n,r),n=0,r=0}}return t+=Math.max(n,r)},r.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case s:t[n]="+"+encodeURI(e[n][1]);break;case i:t[n]="-"+e[n][1].length;break;case o:t[n]="="+e[n][1].length}return t.join("\t").replace(/%20/g," ")},r.prototype.diff_fromDelta=function(e,t){for(var n=[],r=0,a=0,l=t.split(/\t/g),c=0;c<l.length;c++){var u=l[c].substring(1);switch(l[c].charAt(0)){case"+":try{n[r++]=[s,decodeURI(u)]}catch(h){throw new Error("Illegal escape in diff_fromDelta: "+u)}break;case"-":case"=":var d=parseInt(u,10);if(isNaN(d)||d<0)throw new Error("Invalid number in diff_fromDelta: "+u);var p=e.substring(a,a+=d);"="==l[c].charAt(0)?n[r++]=[o,p]:n[r++]=[i,p];break;default:if(l[c])throw new Error("Invalid diff operation in diff_fromDelta: "+l[c])}}if(a!=e.length)throw new Error("Delta length ("+a+") does not equal source text length ("+e.length+").");return n},r.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},r.prototype.match_bitap_=function(e,t,n){function r(e,r){var i=e/t.length,o=Math.abs(n-r);return s.Match_Distance?i+o/s.Match_Distance:o?1:i}if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var i=this.match_alphabet_(t),s=this,o=this.Match_Threshold,a=e.indexOf(t,n);a!=-1&&(o=Math.min(r(0,a),o),a=e.lastIndexOf(t,n+t.length),a!=-1&&(o=Math.min(r(0,a),o)));var l=1<<t.length-1;a=-1;for(var c,u,h,d=t.length+e.length,p=0;p<t.length;p++){for(c=0,u=d;c<u;)r(p,n+u)<=o?c=u:d=u,u=Math.floor((d-c)/2+c);d=u;var f=Math.max(1,n-u+1),_=Math.min(n+u,e.length)+t.length,g=Array(_+2);g[_+1]=(1<<p)-1;for(var m=_;m>=f;m--){var v=i[e.charAt(m-1)];if(0===p?g[m]=(g[m+1]<<1|1)&v:g[m]=(g[m+1]<<1|1)&v|((h[m+1]|h[m])<<1|1)|h[m+1],g[m]&l){var y=r(p,m-1);if(y<=o){if(o=y,a=m-1,!(a>n))break;f=Math.max(1,2*n-a)}}}if(r(p+1,n)>o)break;h=g}return a},r.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},r.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var n=t.substring(e.start2,e.start2+e.length1),r=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,n=t.substring(e.start2-r,e.start2+e.length1+r);r+=this.Patch_Margin;var i=t.substring(e.start2-r,e.start2);i&&e.diffs.unshift([o,i]);var s=t.substring(e.start2+e.length1,e.start2+e.length1+r);s&&e.diffs.push([o,s]),e.start1-=i.length,e.start2-=i.length,e.length1+=i.length+s.length,e.length2+=i.length+s.length}},r.prototype.patch_make=function(e,t,n){var a,l;if("string"==typeof e&&"string"==typeof t&&"undefined"==typeof n)a=e,l=this.diff_main(a,t,!0),l.length>2&&(this.diff_cleanupSemantic(l),this.diff_cleanupEfficiency(l));else if(e&&"object"==typeof e&&"undefined"==typeof t&&"undefined"==typeof n)l=e,a=this.diff_text1(l);else if("string"==typeof e&&t&&"object"==typeof t&&"undefined"==typeof n)a=e,l=t;else{if("string"!=typeof e||"string"!=typeof t||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");a=e,l=n}if(0===l.length)return[];for(var c=[],u=new r.patch_obj,h=0,d=0,p=0,f=a,_=a,g=0;g<l.length;g++){var m=l[g][0],v=l[g][1];switch(h||m===o||(u.start1=d,u.start2=p),m){case s:u.diffs[h++]=l[g],u.length2+=v.length,_=_.substring(0,p)+v+_.substring(p);break;case i:u.length1+=v.length,u.diffs[h++]=l[g],_=_.substring(0,p)+_.substring(p+v.length);break;case o:v.length<=2*this.Patch_Margin&&h&&l.length!=g+1?(u.diffs[h++]=l[g],u.length1+=v.length,u.length2+=v.length):v.length>=2*this.Patch_Margin&&h&&(this.patch_addContext_(u,f),c.push(u),u=new r.patch_obj,h=0,f=_,d=p)}m!==s&&(d+=v.length),m!==i&&(p+=v.length)}return h&&(this.patch_addContext_(u,f),c.push(u)),c},r.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],s=new r.patch_obj;s.diffs=[];for(var o=0;o<i.diffs.length;o++)s.diffs[o]=i.diffs[o].slice();s.start1=i.start1,s.start2=i.start2,s.length1=i.length1,s.length2=i.length2,t[n]=s}return t},r.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var r=0,a=[],l=0;l<e.length;l++){var c,u=e[l].start2+r,h=this.diff_text1(e[l].diffs),d=-1;if(h.length>this.Match_MaxBits?(c=this.match_main(t,h.substring(0,this.Match_MaxBits),u),c!=-1&&(d=this.match_main(t,h.substring(h.length-this.Match_MaxBits),u+h.length-this.Match_MaxBits),(d==-1||c>=d)&&(c=-1))):c=this.match_main(t,h,u),c==-1)a[l]=!1,r-=e[l].length2-e[l].length1;else{a[l]=!0,r=c-u;var p;if(p=d==-1?t.substring(c,c+h.length):t.substring(c,d+this.Match_MaxBits),h==p)t=t.substring(0,c)+this.diff_text2(e[l].diffs)+t.substring(c+h.length);else{var f=this.diff_main(h,p,!1);if(h.length>this.Match_MaxBits&&this.diff_levenshtein(f)/h.length>this.Patch_DeleteThreshold)a[l]=!1;else{this.diff_cleanupSemanticLossless(f);for(var _,g=0,m=0;m<e[l].diffs.length;m++){var v=e[l].diffs[m];v[0]!==o&&(_=this.diff_xIndex(f,g)),v[0]===s?t=t.substring(0,c+_)+v[1]+t.substring(c+_):v[0]===i&&(t=t.substring(0,c+_)+t.substring(c+this.diff_xIndex(f,g+v[1].length))),v[0]!==i&&(g+=v[1].length)}}}}}return t=t.substring(n.length,t.length-n.length),[t,a]},r.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",r=1;r<=t;r++)n+=String.fromCharCode(r);for(var r=0;r<e.length;r++)e[r].start1+=t,e[r].start2+=t;var i=e[0],s=i.diffs;if(0==s.length||s[0][0]!=o)s.unshift([o,n]),i.start1-=t,i.start2-=t,i.length1+=t,i.length2+=t;else if(t>s[0][1].length){var a=t-s[0][1].length;s[0][1]=n.substring(s[0][1].length)+s[0][1],i.start1-=a,i.start2-=a,i.length1+=a,i.length2+=a}if(i=e[e.length-1],s=i.diffs,0==s.length||s[s.length-1][0]!=o)s.push([o,n]),i.length1+=t,i.length2+=t;else if(t>s[s.length-1][1].length){var a=t-s[s.length-1][1].length;s[s.length-1][1]+=n.substring(0,a),i.length1+=a,i.length2+=a}return n},r.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var a=e[n];e.splice(n--,1);for(var l=a.start1,c=a.start2,u="";0!==a.diffs.length;){var h=new r.patch_obj,d=!0;for(h.start1=l-u.length,h.start2=c-u.length,""!==u&&(h.length1=h.length2=u.length,h.diffs.push([o,u]));0!==a.diffs.length&&h.length1<t-this.Patch_Margin;){var p=a.diffs[0][0],f=a.diffs[0][1];p===s?(h.length2+=f.length,c+=f.length,h.diffs.push(a.diffs.shift()),d=!1):p===i&&1==h.diffs.length&&h.diffs[0][0]==o&&f.length>2*t?(h.length1+=f.length,l+=f.length,d=!1,h.diffs.push([p,f]),a.diffs.shift()):(f=f.substring(0,t-h.length1-this.Patch_Margin),h.length1+=f.length,l+=f.length,p===o?(h.length2+=f.length,c+=f.length):d=!1,h.diffs.push([p,f]),f==a.diffs[0][1]?a.diffs.shift():a.diffs[0][1]=a.diffs[0][1].substring(f.length))}u=this.diff_text2(h.diffs),u=u.substring(u.length-this.Patch_Margin);var _=this.diff_text1(a.diffs).substring(0,this.Patch_Margin);""!==_&&(h.length1+=_.length,h.length2+=_.length,0!==h.diffs.length&&h.diffs[h.diffs.length-1][0]===o?h.diffs[h.diffs.length-1][1]+=_:h.diffs.push([o,_])),d||e.splice(++n,0,h)}}},r.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},r.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),a=0,l=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;a<n.length;){var c=n[a].match(l);if(!c)throw new Error("Invalid patch string: "+n[a]);var u=new r.patch_obj;for(t.push(u),u.start1=parseInt(c[1],10),""===c[2]?(u.start1--,u.length1=1):"0"==c[2]?u.length1=0:(u.start1--,u.length1=parseInt(c[2],10)),u.start2=parseInt(c[3],10),""===c[4]?(u.start2--,u.length2=1):"0"==c[4]?u.length2=0:(u.start2--,u.length2=parseInt(c[4],10)),a++;a<n.length;){var h=n[a].charAt(0);try{var d=decodeURI(n[a].substring(1))}catch(p){throw new Error("Illegal escape in patch_fromText: "+d)}if("-"==h)u.diffs.push([i,d]);else if("+"==h)u.diffs.push([s,d]);else if(" "==h)u.diffs.push([o,d]);else{if("@"==h)break;if(""!==h)throw new Error('Invalid patch mode "'+h+'" in: '+d)}a++}}return t},r.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},r.patch_obj.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var n,r=["@@ -"+e+" +"+t+" @@\n"],a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case s:n="+";break;case i:n="-";break;case o:n=" "}r[a+1]=n+encodeURI(this.diffs[a][1])+"\n"}return r.join("").replace(/%20/g," ")},t.exports=r},{}],5:[function(e,t,n){var r=logger.create("electronRunner").debug,i=e("path"),s=e("child_process"),o=e("./runWorkerPool"),a=e("./browserEnvironment"),l=0,c=function(e){var t=this;t._project=e,t._screenShotReady=Q.when(!0),t._params=e.settings().env.params,t._runner=e.settings().env.runner,t._envOptions=e.settings().env.options,t._clearMemoryCache=e.settings().env.clearMemoryCache,t._host=void 0,t._callbacks=Object.create(null),t._hostPromise=Q.promise(function(e,n){try{var r=_.extend({},process.env,t._params.env?_.reduce(t._params.env.split(";"),function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{}):{});delete r.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete r.ELECTRON_RUN_AS_NODE,r.ELECTRON_DISABLE_SECURITY_WARNINGS=!0,t._host=s.fork(i.join(__dirname,"runners","browser","electronHost.js"),[],{execPath:t._runner,env:r,execArgv:t._params.runner?t._params.runner.split(" "):[]}),t._host.on("error",function(e){t._handleHostError(e)}),t._host.on("message",function(n){try{n.id?t._responseWithCorrelationId(n):"ready"===n.type?e(t._host):"error"===n.type&&t._handleHostError(n.error)}catch(r){t._handleHostError(r)}})}catch(o){n(o)}})["catch"](function(e){t._handleHostError(e)}),t._workerPool=new o(t._project,{create:_.bind(t._create,t),recycle:_.bind(t._recycle,t),healthy:function(){return!0},prepare:_.bind(t._prepare,t)}),t._browserEnvironment=new a(e,t._workerPool)};c.prototype={run:function(e){var t=this;return t._workerPool.run(e)},_handleHostError:function(e){var t=this;e=e||{},t._project._cleanStack(e);var n="Electron runner error: "+(e.message||"unknown"),r=e.stack||n;console.error(r),t._project._emitTestRunError(n)},_create:function(e,t){var n=this;n._hostPromise.then(function(){t({pageId:e})})},_recycle:function(e){var t=this;t._host&&t._host.send({type:"closePage",pageId:e.pageId})},_evaluateOnPage:function(e,t,n){var r=this,i={type:"evaluateOnPage",pageId:e,action:"("+t.toString()+")()"};r._requestWithCorrelationId(i,n||_.noop)},_openPage:function(e,t,n,r){var i=this,s={type:"openPage",pageId:e,url:t,options:n};i._requestWithCorrelationId(s,r||_.noop)},_closePage:function(e){var t=this;t._host.send({type:"closePage",pageId:e})},_capturePage:function(e,t){var n=this,r=Q.defer();try{n._requestWithCorrelationId({type:"capturePage",file:t,pageId:e},function(){r.resolve()}),n._screenShotReady=r.promise}catch(i){r.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",i.message)}},_prepare:function(e,t){var n=this,i=_.randomId(),s=n._browserEnvironment.sandboxName(t,i);return r("Starting sandbox [%s]",s),n._workerPool.getWorker(t).then(function(){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(r("Preparing sandbox [%s]",s),n._browserEnvironment.prepareSandbox(e,i,t))}).then(function(e){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(r("Prepared sandbox [%s]",s),Q.when({instance:{resume:function(){n._evaluateOnPage(t,function(){$_$tracer.resume()})},ping:function(e){n._evaluateOnPage(t,function(){},e)},close:function(){n._closePage(t)},closing:function(){n._screenShotReady=Q.when()},start:function(r){n._openPage(t,e,n._envOptions,function(e){r(e.status)&&n._evaluateOnPage(t,function(){$_$tracer.start()})})}},name:s,sessionId:i,workerId:t}))})},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp()).then(function(t){return e._workerPool.setFileRoot(e._browserEnvironment.sandboxRootUrl()),Q.when(t)})},stop:function(){var e=this;e._host&&(e._host.send({type:"stop"}),e._host.disconnect(),delete e._callbacks,delete e._host),e._workerPool.stop()},_requestWithCorrelationId:function(e,t){var n=this,r=++l,i=n._callbacks[r]={done:t};e.id=r,n._host.send(e),i.timeout=setTimeout(function(){delete n._callbacks[r]},12e5)},_responseWithCorrelationId:function(e){var t=this._callbacks[e.id];delete this._callbacks[e.id],t&&(clearTimeout(t.timeout),t.done(e))}},t.exports=c},{"./browserEnvironment":2,"./runWorkerPool":15,child_process:void 0,path:void 0}],6:[function(e,t,n){var r=new(e("../../diffMatchPatch"));t.exports={tests:function(e,t){var n=this,r="";return _.isString(e)?r+=t?n._error(e):n._escapeAndConvertToHtml(e):(_.each(e.errors,function(e){r+=n._error(e.message,e.stack,e.expected,e.actual)}),_.each(e.tests,function(e){r+=n._test(e)})),r},_error:function(e,t,n,r){var i=this,s="";return(n||r)&&(s=i._diff(n,r)+"<br/>"),'<section class="error">'+s+'<section class="header">'+i._escapeAndConvertToHtml(e)+"</section>"+_.reduce(t,function(e,t){return e+=i._line(t)},"")+"</section>"},_line:function(e){var t=this._escape(e.file),n=e.context&&this._escape(e.context)||"";return t?'<section class="line">at '+(n?n+" ":"")+'<a class="loc" data-file="'+t+'" data-loc="'+e.loc+'">'+t+":"+e.loc+"</a></section>":""},_test:function(e){var t=this,n=e.path&&_.last(e.path)||"",r=_.initial(e.path||[]).join(" ");n=n&&" "+t._escape(n),r=r&&" "+t._escape(r);var i=_.isNumber(e.time)?" "+e.time+" ms":"",s=t._escape(e.file);return'<section class="test'+(e.failing?" failing":"")+'"><section class="header"><a class="'+(e.loc?"loc":"text")+'" data-file="'+s+'" data-loc="'+e.loc+'">'+e.file+'</a><span class="suite">'+r+'</span><span class="name">'+n+"</span>"+(i?'<span class="time">'+i+"</span>":"")+"</section>"+_.reduce(e.errors,function(e,n){return e+=t._error(n.message,n.stack,n.expected,n.actual)},"")+(e.messages&&e.messages.length?_.reduce(e.messages,function(e,n){return e+='<section class="message '+n.type+'"><span class="text">'+t._escapeAndConvertToHtml(n.text)+"&nbsp;</span>"+t._line(n)+"</section>"},'<section class="console"><section class="header">From console:</section>')+"</section>":"")+"</section>"},_diff:function(e,t){try{return'<section class="diff" style="white-space: pre;">'+r[r.diff_prettyCompactHtml?"diff_prettyCompactHtml":"diff_prettyHtml"](r.diff_wordMode(e||"",t||"")).replace(/&para;<br>/g,"<br>").replace(/style="background:#e6ffe6;"/g,'class="status-added"').replace(/style="background:#ffe6e6;"/g,'class="status-removed"')+"</section>"}catch(n){return""}},_escape:function(e){return(e||"").toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},_escapeAndConvertToHtml:function(e){return this._escape(e).replace(/(?:\r\n|\r|\n)/g,"<br/>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\s/g,"&nbsp;")}}},{"../../diffMatchPatch":4}],7:[function(e,t,n){t.exports={lineState:{notCovered:1,fullyCovered:2,partiallyCovered:3,errorSource:4,errorPath:5}}},{}],8:[function(e,t,n){var r=function(e){return e&&e.replace(/^\s+|\s+$/gm,"")},i=["January","February","March","April","May","June","July","August","September","October","November","December"];t.exports={normalizePath:function(e){return"win32"===process.platform&&e?e.replace(/\\/g,"/"):e},parseKey:function(e){var t={};if(e){var n=e.split(":");2===n.length&&(e=r(n[1]))}var s=Buffer.from(e,"base64").toString().split("\n");t.licenseeName=s[0],t.licenseTags=s[1];var o=t.licenseTags.split(",")||[];t.licenseeEmail=o[0],t.licensedProduct=o[1],t.multiUserKey=o[2],t.source=o[3],t.expirationDateString=s[2],t.licenseSignature=s[3];try{var a=t.expirationDateString.split("/");t.expirationDateStringFormatted=a[0]+" "+i[parseInt(a[1],10)-1]+" "+a[2]}catch(l){t.expirationDateStringFormatted=t.expirationDateString}return t},format:function(e,t){return e.replace(/\{([0-9a-zA-Z_]+)\}/g,function(n,r,i){var s;return"{"===e[i-1]&&"}"===e[i+n.length]?r:(s=t.hasOwnProperty(r)?t[r]:null,null===s||void 0===s?"":s)})},validPackageName:function(e){if(e&&!e.match(/^\./)&&!e.match(/^_/)&&!(e.length>214||e.toLowerCase()!==e||/[~'!()*]/.test(e.split("/").slice(-1)[0]))){if(encodeURIComponent(e)===e)return e;var t=e.match(/^(?:@([^\/]+?)[\/])?([^\/]+?)$/);if(t){var n=t[1],r=t[2];if(encodeURIComponent(n)===n&&encodeURIComponent(r)===r)return e}}}}},{}],9:[function(e,t,n){var r=e("path"),i=e("parseurl"),s=e("mime"),o=e("graceful-fs"),a=new Map,l=function(e,t,n){e.set({"Cache-Control":"public, max-age=86400",Expires:new Date(Date.now()+864e5).toUTCString()}),e.type(s.lookup(n,"text/plain")),e.status(200).end(t)};t.exports={create:function(e,t){var n=logger.create("middleware").trace,s=e.main.cache?e.main.cache:a;return e.main.read=e.main.read?e.main.read:o.readFile,e.alt&&(e.alt.cache||(e.alt.cache={get:function(){return null},set:function(){return null}}),e.alt.read=e.alt.read?e.alt.read:o.readFile),function(o,a){var c=i(o).pathname;"/"===c&&(c="");var u=e.main.root;n("Preparing to serve %s",c||u);var h=r.normalize(r.join(u,c)),d=s.get(h);if(_.isString(d)||d instanceof Buffer)n("Serving %s from cache",c||u),l(a,d,h);else{var p=function(e,i,s,o){s?e?(u=e.root,n("Serving %s from disk (alt. location)",c||u),h=r.normalize(r.join(u,c)),e.read(h,p.bind(null,null,e.cache))):(n("Error when reading file %s, %s",h,s&&s.message||"unknown"),t&&console.error("Trying to access missing resource or API: "+c),a.status(404).end()):(i.set(h,o),l(a,o,h))};n("Serving %s from disk",c||u),e.main.read(h,p.bind(null,e.alt,s))}}}}},{"graceful-fs":void 0,mime:void 0,parseurl:void 0,path:void 0}],10:[function(e,t,n){global._=e("lodash"),global.Q=e("q"),global.EventEmitter=e("events").EventEmitter,Q.longStackSupport=!1,global.Promise||(global.Promise=Q.Promise),_.extend(_,e("./utils")),_.str=e("underscore.string"),_.mixin(_.str.exports()),global.logger=e("./logger"),_["_"+["nv","zy","49","oq","qg"].join("")]=["nv","zy","49","oq","qg"].join("")},{"./logger":11,"./utils":16,events:void 0,lodash:void 0,q:void 0,"underscore.string":void 0}],11:[function(e,t,n){function r(e){var t=this.namespace;e[0]=i()+t+" "+e[0]}function i(){return _.inspectOpts.hideDate?"":(new Date).toISOString()+" "}function s(e){return process.stdout.write(e)}function o(e){function t(e,n){function r(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(r.enabled){var s=r,o=Number(new Date),a=o-(i||o);s.diff=a,s.prev=i,s.curr=o,i=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");var u=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;u++;var i=t.formatters[r];if("function"==typeof i){var o=e[u];n=i.call(s,o),e.splice(u,1),u--}return n}),t.formatArgs.call(s,e);var h=c.format.apply(c,l(e))+"\n";s.isDebug?(d.add(h),p&&t.log.call(s,h)):t.log.call(s,h)}}var i;return r.isDebug="debug"===n,r.isTrace="trace"===n,r.namespace=e,r.enabled=r.isTrace&&f||r.isDebug,t.instances.push(r),r}function n(e){return e instanceof Error?e.stack||e.message:e}return t.debug=t,t["default"]=t,t.coerce=n,t.instances=[],Object.keys(e).forEach(function(n){t[n]=e[n]}),t.formatters={},t}var a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=s["return"])&&n.call(s)}finally{if(i)throw i.error}}return o},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},c=e("util"),u=new(e("lru-cache"))({max:2097152,length:function(e){return e.length}}),h=0,d={add:function(e){u.set(h++,e)},values:function(){var e=u.values();return e.reverse(),e}},p=process.env.WALLABY_DEBUG_ENABLED||!1,f=process.env.WALLABY_TRACE_ENABLED||!1,_={};_.log=s,_.formatArgs=r,_.inspectOpts=Object.keys(process.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var n=t.substring(6).toLowerCase().replace(/_([a-z])/g,function(e,t){return t.toUpperCase()}),r=process.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[n]=r,e},{depth:25,maxArrayLength:100,breakLength:200});var g=o(_),m=g.formatters;m.o=function(e){return c.inspect(e,_.inspectOpts).replace(/\s*\n\s*/g," ")},m.O=function(e){return c.inspect(e,_.inspectOpts)},t.exports={create:function(e){return{debug:g(e,"debug"),trace:g(e,"trace")}},enableDebug:function(){p||(process.env.WALLABY_DEBUG_ENABLED="true",p=!0,d.values().forEach(function(e){_.log(e)}))},getDebugLog:function(){return d.values()},enableTrace:function(){f||(process.env.WALLABY_TRACE_ENABLED="true",f=!0,g.instances.forEach(function(e){e.isTrace&&(e.enabled=!0)})),this.enableDebug()}}},{"lru-cache":void 0,util:void 0}],12:[function(e,t,n){var r=(e("fs"),e("path")),i=e("child_process").spawn,s=logger.create("nodeRunner").debug,o=e("./runWorkerPool"),a=e("./utils"),l="###wpm###",c=function(e){var t=this;t._project=e,t._nodePath=e.settings().env.runner,t._initializer=e.settings().bootstrap,t._teardown=e.settings().teardown,t._slowTestThreshold=e.settings().slowTestThreshold,t._zeroConfigJest=e.isZeroConfigJest(),t._nodeModules=r.join(e._localRoot,"node_modules");try{t._regeneratorRuntime=r.join(r.dirname(a.resolveModulePathFrom(t._nodeModules,"regenerator-runtime")),"runtime.js")}catch(n){}t._params=e.settings().env.params,t._recycle=e.settings().workers.recycle,t._testFramework=e.settings().testFramework,t._cwd=process.env.quokka||t._zeroConfigJest?process.cwd():e._instrumentedRoot,t._localProjectDir=e._localProjectDir,t._originalCacheRoot=e._originalRoot,t._reportUnhandledPromises=!!e.settings().reportUnhandledPromises,t._maxLogEntrySize=e.settings().maxLogEntrySize,t._workerPool=new o(t._project,{create:_.bind(t._createNodeInstance,t),recycle:_.bind(t._recycleNodeInstance,t),healthy:_.bind(t._isNodeInstanceHealthy,t),prepare:_.bind(t._prepare,t)}),t._workerPool.setFileRoot(t._cwd)};c.prototype={run:function(e){var t=this;return t._workerPool.run(e)},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start()},stop:function(){var e=this;e._workerPool.stop()},_createNodeInstance:function(e,t){var n=this;setImmediate(function(){try{process.env.quokka&&(n._params=n._project.settings().env.params,n._recycle=n._project.settings().workers.recycle);var r=(n._params.runner?_.map(n._params.runner.replace(/"([^"]+)"/g,function(e){return e.replace(/\s/g,"_space_token_")}).split(" "),function(e){return _.trim(e.replace(/_space_token_/g," "),'"')}):[]).concat([process.mainModule.filename,"runner",e,n._workerPool.receiverPort(),n._testFramework.version+(n._testFramework.autoDetected?",autoDetected":""),n._testFramework.path||"",n._nodeModules,n._originalCacheRoot,process.env.BABEL_ENV&&n._regeneratorRuntime||"",n._testFramework.configFile||""]),o=_.extend({},process.env,n._params.env?_.reduce(n._params.env.split(";"),function(e,t){var n=t.split("="),r=_.trimLeft(n[0]);return e[r]=t.substring(n[0].length+1),e},{}):{});delete o.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete o.ELECTRON_RUN_AS_NODE;var a={process:i(n._nodePath,r,{cwd:n._cwd,env:o}),onConnected:function(e){_.isFunction(e)?this._onConnected=e:this._onConnected&&(this._onConnected(e),delete this._onConnected,delete this.onConnected)}};a.process.stderr.on("data",function(e){var t=e.toString("utf8");s("Error in worker: %s",t),console.error(t)}),t(a)}catch(l){s("Error while creating worker #%s: %s",e,l&&(l.stack||l.message)),t()}})},_recycleNodeInstance:function(e){try{e.process.stdout.removeAllListeners("data"),e.process.stderr.removeAllListeners("data")}finally{e.process.kill()}},_isNodeInstanceHealthy:function(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode},_prepare:function(e,t){var n=this,r=_.randomId(),i=n._sandboxName(t,r);return s("Starting sandbox [%s]",i),Q.when().then(function(){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(s("Preparing sandbox [%s]",i),n._workerPool.getWorker(t))}).then(function(o){return s("Prepared sandbox [%s]",i),Q.when({instance:{resume:function(){o.channel.send(JSON.stringify({type:"in:tracer.resume",data:{}}))},ping:function(e){var t=_.uniqueId(),n=function(r){var i;try{i=JSON.parse(r)}catch(s){return}"pong"===i.type&&i.data===t&&(o.channel.removeListener("message",n),e())};o.channel.on("message",n),o.channel.send(JSON.stringify({type:"in:ping",data:t}))},teardown:function(){o.channel.send(JSON.stringify({type:"in:teardown",data:{}}))},close:function(){n._recycle?(n._workerPool.recycleWorker(t),n._workerPool.getWorker(t).then(_.noop)):o.channel.send(JSON.stringify({type:"in:stop",data:{}}))},closing:_.noop,start:function(t,i){if(t("success")){try{o.process.stdout.removeAllListeners("data"),o.process.stdout.on("data",function(e){try{e=e&&e.toString("utf8"),~e.indexOf(l)&&(e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(l))try{JSON.parse(e);o.channel.emit("message",e)}catch(t){s("Error while processing STDOUT message: "+t.message)}}))}catch(t){s("Error while processing STDOUT message: "+t.message)}})}catch(a){s("Error while subscribing to process STDOUT: "+a.message)}o.process.stderr.removeAllListeners("data"),o.process.stderr.on("data",function(e){if(e=e&&e.toString("utf8"),!e||0!==e.indexOf("Debugger listening on port")){var t="";if(~e.indexOf(l)){var n;e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(l))try{n=JSON.parse(e)}catch(t){s("Error while processing STDERR message: "+t.message)}}),n&&i(n.message,n.stack,n.actual,n.expected)}else{if(e){var r=e.split("\n"),o=[];_.each(r,function(e){return!_.startsWith(_.trimLeft(e),"at")&&void o.push(e)}),t=o.join("\n")}i(t,e)}}});var c={sessionId:r,tests:e.tests,files:_.reduce(e.allFiles.concat(e.allTestFiles),function(t,r){if(_.isNumber(r.id)){var i={id:r.id,rangesLength:r.rangesLength};if(t.push(i),n._zeroConfigJest&&(i.path=r.normalizedRelativePath,i.parentFilePath=r.parentFilePath,i.childFilePath=r.childFilePath,i.numberOfFunctions=r.numberOfFunctions,i.ts=r.ts,i.inOriginalFilesCache=r.inOriginalFilesCache,i.instrument=r.instrument,i.transientChange=r.transientChange,r.test)){i.test=!0;var s=r.changeStart&&r.changePosition&&!r.relatedFilesWithTests&&!n._project.hadGlobalErrorsPreviousRun()&&!n._project.settings().runAllTestsInAffectedTestFile&&!e.fullRun;s&&(i.allowedToRunChangedTestOnly=!0,i.changeStart=r.changeStart,i.changePosition=r.changePosition)}}return t},[]),testFiles:_.map(e.testFilesToLoad,function(e){var t;if(0===n._testFramework.version.indexOf("jest")){var r=n._project._getFileMetadataById(e.originalId||e.id);t=r&&r.getFileLineMap()}return{path:e.path,id:e.originalId||e.id,type:e.type,originalType:e.originalType,content:process.env.quokka?e.content:void 0,lineMap:t}}),root:n._cwd,localProjectDir:n._localProjectDir,flushCache:!1,initializer:n._initializer,teardown:n._teardown,slowTestThreshold:n._slowTestThreshold,manualTestRun:e.manualRun,reportUnhandledPromises:n._reportUnhandledPromises,maxLogEntrySize:n._maxLogEntrySize,expressionsToEvaluate:e.expressionsToEvaluate,hints:n._project.settings().hints,autoConsoleLog:n._project.settings().autoConsoleLog,preserveComments:n._project.settings().preserveComments,reportConsoleErrorAsError:n._project.settings().reportConsoleErrorAsError,suppressClearingRequireCache:n._zeroConfigJest||void 0,traceContext:e.traceContext||void 0,suppressCallStackEval:!!process.env.quokka||void 0,updateNoMoreThanOneSnapshotPerTestFileRun:n._project.settings().updateNoMoreThanOneSnapshotPerTestFileRun||void 0,runGlobals:e.runGlobals||!1,processEnvUpdates:e.processEnvUpdates,customJestConfig:n._project.settings().customJestConfig||void 0};o.channel.send(JSON.stringify({type:"in:run",data:c}))}}},name:i,sessionId:r,workerId:t})})},_sandboxName:function(e,t){return"worker #"+e+", session #"+t}},t.exports=c},{"./runWorkerPool":15,"./utils":16,child_process:void 0,fs:void 0,path:void 0}],13:[function(e,t,n){var r=logger.create("phantomRunner").debug,i=e("phantom"),s=e("./runWorkerPool"),o=e("./browserEnvironment"),a=!1,l=function(e){var t=this;t._project=e,t._screenShotReady=Q.when(!0),t._params=e.settings().env.params,t._viewportSize=e.settings().env.viewportSize,t._clearMemoryCache=e.settings().env.clearMemoryCache,t._phantomjsPath=e.settings().env.runner,t._workerPool=new s(t._project,{create:_.bind(t._createPhantomInstance,t),recycle:_.bind(t._recyclePhantomInstance,t),healthy:_.bind(t._isPhantomInstanceHealthy,t),prepare:_.bind(t._prepare,t)}),t._browserEnvironment=new o(e,t._workerPool)};l.prototype={run:function(e){var t=this;return t._workerPool.run(e)},_createPhantomInstance:function(e,t){var n=this;try{
var s={dnodeOpts:{weak:!1}};n._phantomjsPath&&(s.binary=n._phantomjsPath),s.onExit=function(t,n){return"SIGSEGV"!==n||a||(console.error("Looks like the PhantomJs version being used is not supported on your OS.\nTry using a different PhantomJs version (https://wallabyjs.com/docs/integration/phantomjs2.html)\nor Chromium/V8 via Electron runner (https://wallabyjs.com/docs/integration/electron.html)"),a=!0),r("Signal killed phantomjs #%s: %s, exit code: %s",e,n,t)};var o=["--disk-cache=yes","--web-security=false"];n._params.runner&&(o=o.concat(_.filter(n._params.runner.split(" "),function(e){return e&&!(~e.indexOf("--disk-cache=")||~e.indexOf("--web-security="))})));var l=!1;o.push(function(i){if(!l){if(!i)return l=!0,r("Additional attempt to create phantom instance #%s",e),n._createPhantomInstance(e,t);i.set("onError",function(t){r("PhantomJs failure: %s, recycling phantom instance #%s",t,e),n._workerPool.recycleWorker(e)}),l=!0,t(i)}}),o.push(s),i.create.apply(i,o)}catch(c){r("Error while creating worker #%s: %s",e,c&&(c.stack||c.message)),t()}},_recyclePhantomInstance:function(e){e.exit(),e.process.kill()},_isPhantomInstanceHealthy:function(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode},_prepare:function(t,n){var i=this,s=_.randomId(),o=i._browserEnvironment.sandboxName(n,s);return r("Starting sandbox [%s]",o),Q.when().then(function(){return i._workerPool.cancelled()?Q.reject({runCancelled:!0}):(r("Preparing sandbox [%s]",o),Q.all([i._getPage(n),i._browserEnvironment.prepareSandbox(t,s,n)]))}).then(function(a){r("Prepared sandbox [%s]",o);var l=a[0],c=a[1];return Q.when({instance:{resume:function(){l.evaluate(function(){$_$tracer.resume()})},ping:function(e){l.evaluate(function(){},e)},close:function(){t=null,l.stop&&l.stop(),l.close()},closing:function(){i._captureScreenShot(t.screen,l)},start:function(n,r){i._clearMemoryCache&&l.onResourceRequested(function(t,n,r){try{var i=global._urlUtil=global._urlUtil||e("url"),s=t.url;if(!s)return;if(0===s.indexOf("data:"))return;if(~s.indexOf("wallabyFileId"))return;var o=i.parse(t.url),a="/"===o.pathname.charAt(0)?o.pathname.substr(1):o.pathname,c=a&&r[a];if(!c)return;var u=o.search&&o.search.length;n.changeUrl(s+(u?"&":"?")+c.ts+"&wallabyFileId="+c.id),l.clearMemoryCache()}catch(h){console.log(h&&h.message)}},_.noop,t.allFilesHash),l.set("onError",r),l.open(c,function(e){n(e)&&l.evaluate(function(){$_$tracer.start()})})}},name:o,sessionId:s,workerId:n})})},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp())},stop:function(){var e=this;e._workerPool.stop()},_captureScreenShot:function(e,t){var n=this;if(e){var r=Q.defer();try{t.render(e,function(){r.resolve()}),n._screenShotReady=r.promise}catch(i){r.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",i.message)}}},_getPage:function(e){var t=this;return t._workerPool.getWorker(e).then(function(n){return t._workerPool.cancelled()?Q.reject({runCancelled:!0}):(r("Creating page for worker #"+e),t._createPage(n,e))})},_createPage:function(e,t){var n=this;return Q.promise(function(i,s){var o=!1,a=setTimeout(function(){o||(l(),n._workerPool.recycleWorker(t),r("Phantom page is not created in time, recycling it"),s({runCancelled:!0,rerun:!0}))},400),l=function(){o=!0,clearTimeout(a)};try{e.createPage(function(e){o||(l(),r("Phantom page created"),e.set("viewportSize",n._viewportSize||{width:800,height:600}),i(e))})}catch(c){l(),s(c)}})}},t.exports=l},{"./browserEnvironment":2,"./runWorkerPool":15,phantom:void 0,url:void 0}],14:[function(e,t,n){function r(e){this.process=s.fork(e,["worker"]),this.pid=this.process.pid,this.status=WorkerState.STARTING,this.process.once("message",this.onReady.bind(this)),o.EventEmitter.call(this)}function i(e,t){function n(){var t=new r(e);t.on("ready",i._run.bind(i)),t.process.on("exit",function(e){if(0!==e){for(var r=0;r<i.workers.length;r++)i.workers[r].pid===t.pid&&i.workers.splice(r,1);n()}}),i.workers.push(t)}this.workers=[],this.queue=[];var i=this;t=t||a.cpus().length;for(var s=0;s<t;s++)n()}var s=e("child_process"),o=e("events"),a=e("os"),l=e("util");WorkerState={STARTING:"STARTING",READY:"READY",BUSY:"BUSY"},l.inherits(r,o.EventEmitter),r.prototype.onReady=function(){this.status===WorkerState.STARTING&&(this.status=WorkerState.READY,this.emit("ready",this))},r.prototype.onMessage=function(e,t){e(t),this.status=WorkerState.READY,this.emit("ready",this)},r.prototype.send=function(e,t){this.status=WorkerState.BUSY,this.emit("busy"),this.process.once("message",this.onMessage.bind(this,t)),this.process.send(e)},i.prototype.enqueue=function(e,t){this.queue.push({task:e,callback:t}),process.nextTick(this._run.bind(this))},i.prototype.stop=function(){_.each(this.workers,function(e){e.process.send({type:"exit"})})},i.prototype._run=function(e){if(0!==this.queue.length){if(!e)for(var t=0;t<this.workers.length;t++)if(this.workers[t].status===WorkerState.READY){e=this.workers[t];break}if(e){var n=this.queue.shift();e.send(n.task,n.callback)}}},t.exports={_queue:void 0,start:function(e){this._queue||(this._queue=new i(e))},started:function(){return!!this._queue},run:function(e){var t=this;return t._queue?Q.promise(function(n,r){try{t._queue.enqueue(e,function(e){n(e)})}catch(i){r(i)}}):Q.reject(new Error("Processor pool is not started"))},stop:function(){this._queue&&(this._queue.stop(),delete this._queue)}}},{child_process:void 0,events:void 0,os:void 0,util:void 0}],15:[function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r["throw"](e))}catch(t){s(t)}}function l(e){e.done?n(e.value):i(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,s&&(o=2&n[0]?s["return"]:n[0]?s["throw"]||((o=s["return"])&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,s=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},o=e("os"),a=e("path"),l=e("http"),c=e("./utils"),u=logger.create("workers").debug,h=e("ws").Server,d=/^win/.test(process.platform),p=5e3,f=200,g="&wallabyFileId=",m="Wallaby.js cache is corrupted, please restart wallaby.js",v=function(e,t){var n=this;n._project=e,n._opts=e.settings(),n._extension=t,process.env.quokka&&(n.reportConsoleOutput=function(t){var n=_.extend({},t);e.resolveLogEntryRange(n),e._emitInternal({type:"consoleOutput",data:n})},n.reportIntermediateResult=function(e){}),n._sessions={},n._executedTestNumber=0,n._testRunId=0,n._workers={},n._testFilesByWorker={},n._workerPingTimeoutOverride={},n._connectingWorkers={},n._workerPendingCleanup={},n._calculateNumberOfParallelWorkers(),n._hasGlobalSetupOrTeardown=this._project.hasGlobalSetupOrTeardown();for(var r=Math.max(n._maxWorkers,n._minWorkers)+(n._hasGlobalSetupOrTeardown?1:0),i=0;i<r;i++)n.getWorker(i);n._globalWorkerId=r,n._normalizedWallabyServerPath=this._project.normalizePath(a.dirname(process.mainModule.filename)),n._normalizedLocalRoot=this._project.normalizePath(this._project._localRoot),n._zeroConfigJest=this._project.isZeroConfigJest(),n._unresponsiveStandardTimeout=Math.max(500,n._opts.unresponsiveStandardTimeout||2e3),n._unresponsiveInitialTimeout=Math.max(n._unresponsiveStandardTimeout,n._opts.unresponsiveInitialTimeout||7e3)};v.prototype={"worker:transformedFile":function(e){this._project.testRunnerTransformedFile(e)},start:function(e){var t=this,n=t._httpServer=e?l.createServer(e):l.createServer();return n.listen(0),Q.promise(function(e,r){n.on("listening",function(){try{t._receiverPort=n.address().port,u("Web server is listening at "+t._receiverPort),t._wss=new h({server:n,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}}),t._wss.on("connection",function(e){e.on("message",function(n){var r;try{r=JSON.parse(n)}catch(i){return void console.error("Failed to deserialize message from worker: "+n+", "+(i&&i.message))}if(t["worker:"+r.type])return t["worker:"+r.type](r.data);if(r.worker){var s=t._workers[r.worker];if(!s)return;if(s.onConnected)s.onConnected(e);else if(process.env.quokka&&s.instance){if(s.instance.channel)try{s.instance.channel.close(),s.instance.channel.removeAllListeners()}catch(i){}s.instance.channel=e}try{e.send(JSON.stringify({type:"in:connected"}))}catch(i){console.error('Failed to send the "connected" message to worker. '+i.message)}}else if(r.session){var o=t._sessions[r.session],a=!o||(o._disposing||t.cancelled(o._testRunId))&&!o._globalSetup;if("console"===r.type&&r.data){if("debugLog"===r.data.type)return void u(r.data.text);(r.data.spec||process.env.quokka)&&!a||"autoLog"===r.data.type||console.log("console."+r.data.type+": "+r.data.text)}if(a)return;try{o[r.type](r.data)}catch(i){console.error("Failed to process message "+r.type+" from worker, "+(i&&i.message)),o.reject(i)}}})}),e()}catch(i){r(i)}})})},wallabyFileIdPrefix:function(){return g},traceContext:function(){return this._traceContext},receiverPort:function(){return this._receiverPort},setFileRoot:function(e){this._fileRoot=this._project.normalizePath(e)},run:function(e){return i(this,void 0,void 0,function(){var t,n,i,o,a,l,c,h,d,f,g,m,v,y,b,T,k,w;return s(this,function(s){switch(s.label){case 0:if(t=this,t._cancelled=!1,t._testRunId++,t._executedTestNumber=0,t._runPriority=e.priority,t._traceContext=e.traceContext,e.recycleBeforeRun&&_.each(t._workers,function(e,n){t.recycleWorker(n)}),u("Starting test run, priority: "+t._runPriority),t._startTime=(new Date).getTime(),n=e.fullRun&&t._maxWorkers>1&&e.testFilesToLoad.length>1?t._maxWorkers:t._minWorkers>1&&e.testFilesToLoad.length>1&&!(e.fullRun&&t._maxWorkers<t._minWorkers)?t._minWorkers:1,i=void 0,!t._hasGlobalSetupOrTeardown)return[3,4];o=setTimeout(function(){console.log("Some long running code has been detected: Global Setup")},p),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,t._runGlobalSetup(e)];case 2:return i=s.sent(),clearTimeout(o),[3,4];case 3:if(a=s.sent(),clearTimeout(o),a.error)throw a.error;return[2,a.result];case 4:1===n&&_.each(e.testFilesToLoad,function(e){return t._testFileIsAssignedToWorker(e,0)}),l=r(r({},e),{processEnvUpdates:i&&i.processEnvUpdates}),h=void 0,s.label=5;case 5:return s.trys.push([5,10,11,14]),n>1?[4,t._runInParallel(l,n)]:[3,7];case 6:return d=s.sent(),[3,9];case 7:return[4,t._prepareSandbox(l,0).then(function(e){return t._runTests(e)})];case 8:d=[s.sent()],s.label=9;case 9:return c=d,[3,14];case 10:throw f=s.sent();case 11:return i?(g=setTimeout(function(){console.log("Some long running code has been detected: Global Teardown")},p),i.sandbox.instance.teardown(),[4,i.result]):[3,13];case 12:if(m=s.sent(),v=m.error,y=m.result,clearTimeout(g),v)throw v;h=y,s.label=13;case 13:return[7];case 14:return t._workerPingTimeoutOverride={},1!==c.length?[3,15]:(T=c[0],[3,17]);case 15:return[4,t._mergeRunTestsResults(c)];case 16:T=s.sent(),s.label=17;case 17:return b=T,h&&(b.log=(b.log||[]).concat(h.log||[]),b.globalErrors=(b.globalErrors||[]).concat(h.globalErrors||[])),t._executedTestNumber&&(t._endTime=(new Date).getTime(),k=t._endTime-t._startTime,w="millisecond(s)",k>1e3&&(k/=1e3,w="second(s)",k>60&&(k/=60,w="minute(s)")),console.log("Finished executing "+t._executedTestNumber+" affected test(s) in "+Math.round(100*k)/100+" "+w)),[2,b]}})})},_handleError:function(e,t,n,r,i,s,o,a,l){var c=this;s===o&&(s=o=void 0),u("Sandbox (%s) [%s] error: %s",e.active()?"active":"inactive",t,n);var h=c._reportableError(n,r),d="SyntaxError: Parse error"===n&&_.isEmpty(r);if(c._corruptedCache(h))return c._project.invalidateCache(),e.reject(new Error(m)),void e.recycleWorker();if(process.env.quokka?u("Runtime error: "+h):console.error("Runtime error: "+h),e.active()){if(e.scheduleCompleteIfNotActiveFor(100),!r)return void e.reject(new Error(n));if(!d)try{var p={message:n,stack:_.isString(r)?r:_.reduce(r,function(e,t){return e+t.file+":"+t.line+"\n"},""),external:!0,actual:s,expected:o,snapshot:a};c._zeroConfigJest&&(p.delayStackMapping=!0,p.allowNotMappedStackLines=!0,e._notMappedStackEntries.push(p));var f=[p];c._processTestLog(f,l),p.stack&&p.stack.length||(~p.message.indexOf("Cannot find module")||(p.message=h),p.stack=[]),!i&&e._executingTest?e.addToTestLog(p):e._globalErrors.push(p)}catch(g){e.reject(new Error(n+", "+(g&&g.message)))}}},_createAndStartSession:function(e,t,n,r){var i=this;try{var s=function(){var s=i._createSession(e.sessionId,e.workerId,e.testRunId,e.instance,t,n,r);e.instance.start(function(t){return i.cancelled(e.testRunId)?(s.reject({runCancelled:!0}),!1):"success"===t||(s.reject(new Error("Sandbox load failed, status: "+t)),!1)},function(t,n,r,o){i._handleError(s,e.sessionId,t,n,!1,r,o)})},o=i._workerPendingCleanup[e.workerId];o?(u("[%s] Sandbox is waiting for worker cleanup",e.sessionId),o.onDone.push(function(r){if(i.cancelled(e.testRunId))return u("[%s] Sandbox run was cancelled while it was waiting for worker cleanup",e.sessionId),n({runCancelled:!0});if(r){u("[%s] Sandbox worker requires recycling, creating new session",e.sessionId);try{return t(i._prepareSandbox(e.opts,e.workerId).then(function(e){return i._runTests(e)}))}catch(o){return n(o)}}s()})):s()}catch(a){n(a)}},_getRunTestResult:function(e){var t=this;if(e.session){var n=e.session,r=t._createRunResult(n,e.time);return _.each(_.keys(n),function(e){e&&"_"===e[0]&&!_.isFunction(n[e])&&"_disposing"!==e&&delete n[e]}),delete e.session,Q.when(r)}return Q.when(e)},_runTests:function(e){var t=this;return t.cancelled(e.testRunId)?Q.reject({runCancelled:!0}):(u("[%s] Running tests in sandbox",e.name),Q.promise(function(n,r){t.cancelled(e.testRunId)&&r({runCancelled:!0}),t._createAndStartSession(e,n,r,void 0)}).then(function(e){return t._getRunTestResult(e)}))},_createRunResult:function(e,t){var n=this,r=e._coverage,i=e._trace,s=e._loadingSequence,o=e._tests,a=e._log,l=e._globalErrors.concat(e._executingTestLog);return _.each(l,function(e){return n._removeAnsi(e)}),l.length||(l=void 0),e._notMappedStackEntries.length&&(_.each(e._notMappedStackEntries,function(e){delete e.delayStackMapping,n._mapStackEntries(e,e.allowNotMappedStackLines),delete e.allowNotMappedStackLines}),e._notMappedStackEntries.length=0),{coverage:r,trace:i,tests:o,log:a,globalErrors:l,loadingSequence:s,time:t}},_removeAnsi:function(e){return!c.hasAnsi(e.message)||c.hasAnsi(e.actual)||c.hasAnsi(e.expected)||(e.message=c.removeAnsi(e.message)),e},_reportableError:function(e,t){var n=this;if(_.isString(t)){var r={stack:t};return n._project._cleanStack(r),t=r.stack}return e},cancel:function(e){var t=this;if(!_.isEmpty(t._sessions))return e>=t._runPriority&&(_.each(t._sessions,function(e){e.reject({runCancelled:!0})}),t._cancelled=!0,u("Cancelling test run, cancel requester priority: %s, current run priority: %s",e,t._runPriority),!0)},cancelled:function(e){return this._cancelled||e&&e!==this._testRunId},_createSession:function(e,t,n,i,s,o,l){var c=this;return c._sessions[e]={_coverage:{},_tests:[],_loadingSequence:{},_log:[],_executingTestLog:[],_globalErrors:[],_total:0,_skipped:0,_disposing:!1,_exceededMaxTestAllowedLogLimit:!1,_onFinished:i.closing,_messagesPerTest:{},_closeByErrorTimeout:0,_longRunningWarningTimeout:0,_longRunningPingTimeout:0,_globalSetupCompleteTimeout:0,_executingFiles:{},_executingTest:void 0,_notMappedStackEntries:[],_globalSetup:!!l,_globalSetupDoneCalled:!1,_completed:!1,_testRunId:n,started:function(t){var n=this;u("[%s] Loaded %s test(s)",e,t.total),this._total=t.total,_.each(t.loadingSequence,function(e){n._loadingSequence[e[0]]=e.slice(1)})},active:function(){return!this._disposing&&!c.cancelled(n)},scheduleCompleteIfNotActiveFor:function(e){var t=this;clearTimeout(t._closeByErrorTimeout),t._closeByErrorTimeout=setTimeout(function(){t.complete()},e)},addToTestLog:function(e){var t=this._executingTestLog[this._executingTestLog.length-1];t&&this._areLogEntryMessagesEqual(t.message||void 0,e.message||void 0)&&t.stack&&e.stack&&t.stack.length>0&&e.stack.length>0&&_.isEqual(e.stack[0],t.stack[0])?e.stack.length>t.stack.length&&(t.stack=e.stack):this._executingTestLog.push(e)},_areLogEntryMessagesEqual:function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),e===t||(c._opts.testFramework&&c._opts.testFramework.version&&0===c._opts.testFramework.version.indexOf("mocha")?e.indexOf(":")>0&&_.contains(e,t)||t.indexOf(":")>0&&_.contains(t,e):void 0)},intermediateComplete:function(){c.reportIntermediateResult&&c.reportIntermediateResult(c._createRunResult(this))},trace:function(e){var t=this;this._trace=e.trace,this._trace&&_.each(this._trace.callStack,function(e){e.delayStackMapping=!0,t._notMappedStackEntries.push(e)})},complete:function(t){var r=this;clearTimeout(this._closeByErrorTimeout),clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout),clearTimeout(this._globalSetupCompleteTimeout),this._completed=!0,r._onFinished(),this._dispose(function(){c.cancelled(n)?o({runCancelled:!0}):s({session:r,time:t&&t.time})}),u("[%s] Run %s test(s), skipped %s test(s)",e,(this._tests||[]).length-this._skipped,this._skipped)},globalSetupComplete:function(e){l&&(this._globalSetupDoneCalled=!0,l(e))},globalError:function(t){c._handleError(this,e,t.message,t.stack,t.declaration,t.actual,t.expected,t.snapshot,t.allowNotMappedStackLines)},programScopeStart:function(e){this._executingFiles[e]=1,this._setTimeoutForLongRunningOperation()},programScopeEnd:function(e){delete this._executingFiles[e],_.isEmpty(this._executingFiles)&&!this._executingTest&&(clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout))},preTest:function(e){this._setTimeoutForLongRunningOperation(),this._executingTest=e},postTest:function(){delete this._executingTest},_setTimeoutForLongRunningOperation:function(){if(!process.env.quokka){var e=this;clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout),this._longRunningWarningTimeout=setTimeout(function(){var t="Some long running code has been detected: ",n=e._executingTest,r=!_.isEmpty(e._executingFiles);if(t+=(n?'test "'+n+'"':"one of your "+(r?"files":"tests"))+" is taking more than "+p+"ms to execute.",r&&(t+="\nExecution of the following files has started but has not finished:",_.each(e._executingFiles,function(e,n){var r=c._project._getFileMetadataById(n);t+="\n- "+(r?r.path:"unknown")})),e._log.length&&(t+="\nThe last recorded console.log: "+_.last(e._log).text),n||r){t+="\nTry commenting out the test or excluding the test file from the `tests` list in your wallaby config,\nand restarting wallaby to make sure that it is this test/file causing the issue and not something else.",n&&(t+="\nAlso review your recent changes to the code that the test covers, as well as its `before` and `after` hooks."),t+="\nPinging test runner sandbox...";try{i.ping(function(){clearTimeout(e._longRunningPingTimeout),e.active()&&console.warn("Sandbox is responsive. The issue may have the asynchronous nature, like a missing callback.")}),e._longRunningPingTimeout=setTimeout(function(){console.warn("The sandbox is not responsive. Check for possibly recently introduced infinite loops.")},f)}catch(s){t+="\nThe sandbox ping failed: "+s.message}}console.warn(t)},p)}},module:function(e){c._project._emitInternal({type:"moduleLoaded",path:e.path,session:this})},test:function(t){var n=this;return delete this._executingTest,clearTimeout(this._closeByErrorTimeout),this._setTimeoutForLongRunningOperation(),t.hook&&t.log?(c._processTestLog(t.log),_.isString(t.hook)&&_.each(t.log,function(e){e.message=t.hook+(e.message?": ":"")+e.message}),void(this._globalErrors=this._globalErrors.concat(t.log))):("disabled"!==t.status?(u("[%s] Test executed: "+t.name,e),c._processTestLog(t.log),t.log&&_.each(t.log,function(e){return n.addToTestLog(e)}),this._executingTestLog.length&&(t.log=this._executingTestLog.slice()),_.isUndefined(t.slow)&&(t.slow=t.time>c._opts.slowTestThreshold),t.slow=t.slow||void 0,this._executingTestLog.length=0,++c._executedTestNumber%50||console.log("Execution progress: "+c._executedTestNumber+" tests"),process.env.WALLABY_INTEGRATION_TEST_RUN&&(t.time=1)):(this._skipped++,c._processTestLog(t.log)),void this._tests.push(t))},coverage:function(e){this._coverage[e.id]=e.ranges},console:function(e){var t=c._opts.maxConsoleMessagesPerTest,n=this._messagesPerTest[e.spec]=(this._messagesPerTest[e.spec]||0)+1;if(n===t+1)console.warn("Number of console messages per test exceeded maximum allowed value ("+t+"), current test console messages recording stopped.\nYou may increase the limit by adding `maxConsoleMessagesPerTest` setting to your config file.");else if(n<=t&&(this._log.push(e),e.valueBag&&e.valueBag.data&&e.valueBag.data.props)){var i=e.valueBag.data,s=i.props[0];if(s.callStack){c._mapStackEntries(s.callStack);var o;if(s.callStack.replaceFirstEntryLine){var l=r({},e);c._project.resolveLogEntryRange(l),o=l.range&&l.range[0]}s.props=s.callStack.stack.map(function(e,t){var n=e[0],r=t>0||!o?e[1]:o,i=c._project.stackEntryByFileIdWithoutLineMapping(n,r);if(i){var l=s.callStack.context[t]||"...";return{id:s.id+",se"+t,target:i,callStackEntryNode:!0,label:{name:l,description:a.basename(i.file)+":"+r},disallowToCopyPath:!0,disallowToCopyData:!0}}}).filter(function(e){return!!e})}}c.reportConsoleOutput(e)},resume:function(){u("Sandbox requested early screen shot capture"),this._onFinished(),this._onFinished=_.noop,i.resume()},reject:function(e){this._disposing||this._dispose(function(){o(c.cancelled(n)?{runCancelled:!0}:e)})},recycleWorker:function(){c.recycleWorker(t)},_dispose:function(n){var r=this;r._disposing=!0,clearTimeout(r._closeByErrorTimeout),clearTimeout(r._longRunningWarningTimeout),clearTimeout(r._longRunningPingTimeout);var s=c._workerPendingCleanup[t]={onDone:[]},o=!1,a=!1,l=function(r){a=!0,o&&clearTimeout(o),delete c._sessions[e],s.onDone&&(s.onDone.forEach(function(e){return e(r)}),s.onDone.length=0),delete c._workerPendingCleanup[t],n()},h=function(){a||(u("[%s] Sandbox is not responsive, recycling worker instance",e),c._tryClosingSandbox(i.close,e),c.recycleWorker(t),l(!0))};if(!r._globalSetup||r._completed||void 0!==c._opts.globalSetupTeardownTimeoutRecycle&&!c._opts.globalSetupTeardownTimeoutRecycle)if(r._globalSetup&&r._completed&&!r._globalSetupDoneCalled)console.error("[%s] Error running Global Setup, recycling worker.",e),h();else if(r._globalSetup&&r._completed&&r._globalErrors.length>0)console.error("[%s] Error running Global Teardown, recycling worker.",e),h();else{try{i.ping(function(){a||(u("[%s] Sandbox is responsive, closing it",e),c._tryClosingSandbox(i.close,e),l())})}catch(d){return u("[%s] Sandbox can not be pinged: %s",e,d&&d.message),void h()}var p=c._workerPingTimeoutOverride[t]||c._unresponsiveStandardTimeout;o=setTimeout(function(){h()},p)}else{var f=Math.max(10,c._opts.globalSetupTeardownTimeout||5e3);console.log("[%s] Global Setup and Teardown is not complete, waiting for %sms before recycling worker",e,f),r._globalSetupCompleteTimeout=setTimeout(function(){console.error("[%s] Global Setup and Teardown did not complete, recycling worker.",e),h()},f)}}}},_tryClosingSandbox:function(e,t){try{e()}catch(n){u("[%s] Sandbox closing error, %s",t,n.message)}},_corruptedCache:function(e){return e&&e.match(/evaluating '[a-z]\.\$_\$coverage\[/)},_processTestLog:function(e,t){var n=this;_.each(e,function(e){var r=e.message&&e.message.indexOf(" in file:///")||-1;~r&&(e.message=e.message.substring(0,r)),n._corruptedCache(e.message)&&(n._project.invalidateCache(),e.message=m),n._removeAnsi(e),n._mapStackEntries(e,t),process.env.quokka&&e.message&&(e.message=e.message.replace(n._normalizedLocalRoot,".").replace(n._project._localRoot,"."))})},_mapStackEntries:function(e,t){var n=this,r=g.length;if(e.stack&&_.isString(e.stack)&&!e.delayStackMapping){var i,s,o=[],a={},l=e.stack.split("\n");l&&n._corruptedCache(l[0])&&(n._project.invalidateCache(),e.message=m),_.each(l,function(e){var l=e.lastIndexOf(g);if(~l){var u=e.substr(l+r).split(":");if(u.length>=2){var h=parseInt(u[1],10);i=n._project.stackEntryByFileId(parseInt(u[0],10)||u[0],h,parseInt(u[2],10)),i&&i.line?(s=n._extractBrowserStackLineContext(e),s&&(a[o.length]=s),o.push([i.file,i.line])):i&&t&&o.push([i.file,h])}}else if(process.env.quokka){if(process.env.quokka)if(e=n._project.normalizePath(e),_.contains(e,n._normalizedWallabyServerPath)){if(_.contains(e,"quokkaStackTraceMarker"))return!1}else{var d,p,f=e;e=e.replace(n._normalizedLocalRoot,".");var m;if(f!==e?(m=f.lastIndexOf(n._normalizedLocalRoot),b=e.substr(m).split(":")):(m=e.lastIndexOf("(")+1,0!==m?b=e.substring(m,e.lastIndexOf(")")-1).split(":"):(m=e.lastIndexOf("at ")+3,b=2!==m?e.substr(m).split(":"):[])),3===b.length){s=n._extractNodeStackLineContext(e,m);var v=parseInt(b[1],10);i=n._project.stackEntryByFilePath(n._project.normalizePath(c.isLevelUpRelativePath(b[0])?b[0]:_.ltrim(b[0],"./")),v,parseInt(b[2],10)),i&&i.line?(d=i.file,p=i.line):!i||i&&!i.file?(d=b[0],p=v):i&&t&&(d=i.file||b[0],p=v),d&&(s&&(a[o.length]=s),o.push([d,p]))}}}else{e=n._project.normalizePath(e);var y=n._fileRoot?e.lastIndexOf(n._fileRoot):-1;if(~y){var b=_.rtrim(e.substr(y+n._fileRoot.length),")").split(":");if(3===b.length||2===b.length){var h=parseInt(b[1],10);i=n._project.stackEntryByFilePath(n._project.normalizePath(_.ltrim(b[0],"/")),h,parseInt(b[2],10)),i&&i.line?(s=n._extractNodeStackLineContext(e,y),s&&(a[o.length]=s),o.push([i.file,i.line])):i&&t&&h>0&&o.push([i.file,h])}}}}),o.length||u("Failed to map the stack to user code, entry message: %s, stack: %s",e.message&&e.message.substring(0,1024),e.stack.substring(0,1024)),e.message=n._project._cleanMessage(e.message),"node"===n._project.settings().env.type&&e.message&&~e.message.indexOf("Cannot find module")&&(e.message=n._project._cleanMessage(e.message,n._project._root)),e.stack=o,_.isEmpty(a)||(e.context=a),e.stackMapped=!0}},_extractNodeStackLineContext:function(e,t){if(t>4&&"("===e[t-1]){var n=e.substr(0,t-2)||"";return n.split("at ")[1]}},_extractBrowserStackLineContext:function(e){var t=e.split(" (http");return t.length>=2?(t[0]||"").split("at ")[1]:(t=e.split("@http"),t.length>=2?t[0]:void 0)},_runGlobalSetup:function(e){return i(this,void 0,void 0,function(){var t,n,o,a,l=this;return s(this,function(c){switch(c.label){case 0:return t=this,n=void 0,o=void 0,a=!1,[4,t._prepareSandbox(r(r({},e),{runGlobals:!0}),t._globalWorkerId)];case 1:return n=c.sent(),[2,new Promise(function(e,r){o=new Promise(function(c){t._createAndStartSession(n,function(e){return i(l,void 0,void 0,function(){var n;return s(this,function(i){switch(i.label){case 0:return[4,t._getRunTestResult(e)];case 1:return n=i.sent(),a?c({result:n}):r({result:n}),[2]}})})},function(e){a?c({error:e}):r({error:e})},function(t){a=!0,e({result:o,sandbox:n,processEnvUpdates:t})})})})]}})})},_mergeRunTestsResults:function(e){u("Merging parallel test run results");var t=_.reduce(e,function(e,t){e.runCancelled=t.runCancelled||e.runCancelled,e.tests=e.tests.concat(t.tests||[]),e.log=e.log.concat(t.log||[]),e.globalErrors=e.globalErrors.concat(t.globalErrors||[]),e.error=t instanceof Error||e.error,e.loadingSequence=_.extend(e.loadingSequence,t.loadingSequence||{});var n=e.coverage;return _.isEmpty(n)?(e.coverage=t.coverage,e):(_.each(t.coverage,function(e,t){var r=n[t];return r?void _.each(e,function(e,t){var n=r[t];return n?void _.extend(n,e):void(r[t]=e)}):void(n[t]=e)}),e)},{coverage:{},tests:[],log:[],globalErrors:[],loadingSequence:{}});return t.runCancelled?Q.reject(t):t.error?Q.reject(t.error):Q.when(t)},_testFileIsAssignedToWorker:function(e,t){var n=this._testFilesByWorker[t]=this._testFilesByWorker[t]||{};n[e.normalizedRelativePath]||(this._workerPingTimeoutOverride[t]=this._unresponsiveInitialTimeout,n[e.normalizedRelativePath]=!0)},_unassignAllTestFilesFromWorker:function(e){this._testFilesByWorker[e]={}},_runInParallel:function(e,t){var n=this,r=e.testFilesToLoad,i={};u("Distributing tests between %s workers",t);for(var s=0;s<t;s++){var o=_.omit(e,"testFiles");o.testFilesToLoad=[],i[s]={opts:o,workerId:s,ranges:0}}return _.each(r,function(e){var t=_.chain(i).sortBy(function(e){return e.ranges}).sortBy(function(e){return e.opts.testFilesToLoad.length}).value()[0];t.opts.testFilesToLoad.push(e),t.ranges+=e.rangesLength,n._testFileIsAssignedToWorker(e,t.workerId)}),u("Running tests in parallel"),Q.all(_.chain(i).filter(function(e){return e.ranges||e.opts.testFilesToLoad.length}).map(function(e){return n._prepareSandbox(e.opts,e.workerId).then(function(e){return n._runTests(e)})}).value())},_prepareSandbox:function(e,t){var n=this._testRunId;return this._extension.prepare(e,t).then(function(t){return t.testRunId=n,t.opts=e,t})},getWorker:function(e){var t=this,n=t._workers[e];return n||(n=t._workers[e]={id:e,promise:Q.promise(function(n,r){var i=t._workers[e];if(i)if(i.instance){if(t._extension.healthy(i.instance))return void n(i);u("Found inactive run worker instance #%s, recycling",e),t.recycleWorker(e)}else if(i.promise)return i.promise;u("Starting run worker instance #"+e);try{t._extension.create(e,function(i){if(!i)return void r(new Error("Failed to create worker instance"));var s=t._workers[e]=t._workers[e]||{id:e};if(i.onConnected){s.onConnected=_.bind(i.onConnected,s),delete i.onConnected;var o,a;s.promise=Q.promise(function(e,t){o=e,a=t});var l=!1,c=setTimeout(function(){if(!l){h();var n=t._workers[e];n&&n._connected?t._extension.recycle(i):t.recycleWorker(e),u("Worker is not created in time, recycling it"),a&&a({runCancelled:!0,rerun:!0}),r({runCancelled:!0,rerun:!0})}},1e4),h=function(){l=!0,clearTimeout(c)},d=t._connectingWorkers[e];d&&t._extension.recycle(d),t._connectingWorkers[e]=i,s.onConnected(function(r){delete t._connectingWorkers[e],l||(h(),u("Started run worker instance (delayed) #"+e),s.instance=i,s._connected=!0,i.channel=r,s.promise=Q.when(i),o&&o(i),n(i))})}else u("Started run worker instance (immediate) #"+e),s.instance=i,s.promise=Q.when(i),n(i)})}catch(s){r(s)}})}),n.promise},reportConsoleOutput:function(e){},recycleWorker:function(e){this._unassignAllTestFilesFromWorker(e);var t=this;try{var n=t._workers[e];n&&n.instance&&t._extension.recycle(n.instance)}catch(r){u("Error while recycling run worker instance #%s: %s",e,r&&(r.stack||r.message))}finally{delete t._workers[e],delete t._workerPendingCleanup[e]}},stop:function(){var e=this;_.each(e._workers,function(t,n){e.recycleWorker(n)});try{e._wss&&e._wss.close()}catch(t){}try{e._httpServer&&e._httpServer.close()}catch(t){}},_calculateNumberOfParallelWorkers:function(){var e=this;e._maxWorkers=Math.max(1,e._opts.workers.initial||Math.max(o.cpus().length-2,2)),d&&!e._opts.workers.initial&&"phantomjs"===e._opts.env.kind&&(e._maxWorkers=Math.min(16,e._maxWorkers)),
e._minWorkers=Math.max(1,e._opts.workers.regular||Math.max(Math.floor(e._maxWorkers/2),2)),u("Parallelism for initial run: %s, for regular run: %s",e._maxWorkers,e._minWorkers)}},t.exports=v},{"./utils":16,http:void 0,os:void 0,path:void 0,ws:void 0}],16:[function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r["throw"](e))}catch(t){s(t)}}function l(e){e.done?n(e.value):i(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,s&&(o=2&n[0]?s["return"]:n[0]?s["throw"]||((o=s["return"])&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,s=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=s["return"])&&n.call(s)}finally{if(i)throw i.error}}return o},a=e("path"),l=e("fs"),c=e("minimatch"),u=e("source-map").SourceMapConsumer,h=e("source-map").SourceMapGenerator,d=/^\s*(\/\*\*?(.|\r?\n)*?\*\/)/,p=/^\s*/,f=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]/g,g=/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,m=/^[\s]*?fit[\s]*?\(|[^.\w\s][\s]*?fit[\s]*?\(|\.[\s]*?only[\s]*?\(/gm,v=/[#@] sourceMappingURL=([^\s'"]*)/,y=RegExp("(?:/\\*(?:\\s*\r?\n(?://)?)?(?:"+v.source+")\\s*\\*/|//(?:"+v.source+"))\\s*","g"),b=/data:application\/json[^,]+base64,/,T=function(e,t){return"js"===e||"jsx"===e||"es6"===e||"es7"===e||"mjs"===e||t&&t.find(function(t){return e===t})},k=function(e){return"ts"===e||"tsx"===e},w=function(e){return"vue"===e},S=function(e,t){return"coffee"===e||/\.(litcoffee|coffee\.md)$/.test(t||"")},x={},C={};"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split("").forEach(function(e,t){x[e]=t,C[t]=e}),t.exports={SourceMapConsumer:u,randomId:function(){return Math.random().toString(36).substr(2,5)},noopTrue:function(){return!0},noopTruePromise:function(){return Q.fcall(this.noopTrue)},isPatch:function(e){return e&&e.length>2&&"@"===e[0]&&"@"===e[1]},isLevelUpRelativePath:function(e){return e&&"."===e[0]&&"."===e[1]},docBlockComment:function(e){var t=e.match(d);return t?t[0].replace(p,"")||"":""},normalizePath:function(e){return e?e.replace("win32"===process.platform?"file:///":"file://","").split(a.sep).join("/"):e},trimSlashes:function(e){return e?e.replace(/^\/|\/$/g,""):e},platformDependentPath:function(e){return!e||"win32"!==process.platform||~e.indexOf(a.sep)?e:e.split("/").join(a.sep)},getSourceMapFromCode:function(e){y.lastIndex=0;for(var t;null!==(t=y.exec(e));){var n=t?t[1]||t[2]||"":null;if(n&&b.test(n)){var r=n.slice(n.indexOf(",")+1);return Buffer.from(r,"base64").toString()}}},pathMatchesPattern:function(t,n,r){if(t){if("string"==typeof n){if(!r||!r.micromatch)return c(t,n,r);var i=e("micromatch").isMatch;return i(t,n,{dot:!0})}return(this.platformDependentPath(r&&r.absolute?"":"./")+this.platformDependentPath(t)).match(n)}},escapePathForRegex:function(e){return"\\"===a.sep&&(e=e.replace(/\\/g,"/")),this.replacePathSepForRegex(this._escapeStrForRegex(e))},_escapeStrForRegex:function(e){return e.replace(/[[\]{}()*+?.\\^$|]/g,"\\$&")},replacePathSepForRegex:function(e){return"\\"===a.sep?e.replace(/(\/|(.)?\\(?![[\]{}()*+?.^$|\\]))/g,function(e,t,n){return n&&"\\"!==n?n+"\\\\":"\\\\"}):e},displayTestName:function(e){return e.replace(/\r?\n|\r/g," ").replace(/\s\s+/g," ")},getOriginalLineByGeneratedLine:function(e,t,n){var r=e[t];if(r){r=this._decodeMapping(r);var i=_.pairs(r);return i.sort(function(e,t){var n=o(e,2),r=n[1].column,i=o(t,2),s=i[1].column;return r-s}),n>=0?parseInt(_.reduce(i,function(e,t){return n>=t[1].column&&t[1].column>=e[1].column?t:e},i[0])[0],10):parseInt(i[0][0],10)}},_updateMapping:function(e,t){var n,r=t.isFirstMap,i=t.currentLineMapping,s=t.previousLineMapping,o=e.originalLine,a=e.generatedColumn,l=e.originalColumn,c=!!e.name;if(r){if(i){var u=i[o];return u?!u.better&&c&&(u.column=a,u.better=!0):i[o]={column:a,better:c},i}return n={},n[o]={column:a,better:c},n}if(s)return i?(_.each(s,function(e,t){var n=i[t];n?(!n.mapped&&(!n.better||n.better&&c)&&l===n.originalColumn||n.mapped&&!n.better&&c&&l===n.originalColumn||n.reset&&!n.better&&c&&l===n.originalColumn)&&(n.originalColumn=n.originalColumn>=0?n.originalColumn:n.column,n.column=a,n.better=c,n.mapped=!0):(e.originalColumn=e.column,l===e.column?(e.column=a,e.better=c,e.mapped=!0):(e.column=0,e.reset=!0),i[t]=e)}),i):(_.each(s,function(e){e.originalColumn=e.column,l===e.column?(e.column=a,e.better=c,e.mapped=!0):(e.column=0,e.better=c,e.reset=!0)}),s)},_decodeMapping:function(e){var t;if(_.isObject(e)||_.isUndefined(e))return e;if(e>=0)return t={},t[e]={column:0},t;for(var n,r={},i=0,s=0,o=0;o<e.length;o+=1){var a=x[e[o]],l=32&a;if(a&=31,s+=a<<i,l)i+=5;else{var c=1&s;s>>>=1;var u=c?0===s?-2147483648:-s:s;n>=0?(r[n]={column:u},n=void 0):n=u,s=i=0}}return r},_encodeMapping:function(e){var t=this;if(!_.isObject(e))return e;var n=_.pairs(e);if(n.length>1){var r=_.findLastIndex(n,function(e){return e[1].better});if(r>=0){n=n.slice(0,r+1);var i=n[r][1].originalColumn,s=n[r][1].column;i>0&&s>0&&(n=n.filter(function(e){return e[1].better||e[1].originalColumn<=i}))}}return 1===n.length&&0===n[0][1].column?parseInt(n[0][0],10):(n.sort(function(e,t){var n=o(e,2),r=n[1],i=o(t,2),s=i[1];return r.better&&s.better||!r.better&&!s.better?0:r.better?-1:s.better?1:void 0}),_.reduce(n,function(e,n){return e+=t._encodeInteger(n[0]),e+=t._encodeInteger(n[1].column)},""))},_encodeInteger:function(e){var t="";e<0?e=-e<<1|1:e<<=1;do{var n=31&e;e>>>=5,e>0&&(n|=32),t+=C[n]}while(e>0);return t},updateFileMap:function(e,t){var n=this;e=e||{};var r=_.extend({},e);return _.each(t,function(e){var t=new u(e),i={},s=_.isEmpty(r),o=_.extend({},r);t.eachMapping(function(e){if(e.generatedLine&&e.originalLine){var t=n._decodeMapping(i[e.generatedLine]),a=n._decodeMapping(o[e.originalLine]),l=n._updateMapping(e,{isFirstMap:s,currentLineMapping:_.clone(t,!0),previousLineMapping:_.clone(a,!0)});l&&(i[e.generatedLine]=l),a&&delete r[e.originalLine]}}),r=_.extend({},r,i)}),_.object(_.map(r,function(e,t){return[t,n._encodeMapping(e)]}))},formatInstrumentationError:function(e,t,n){var r=(e&&(e.stack||e.message))+"",i=this.textLines(r),s=i[0],o=s.match(/^SyntaxError.*\((\d+):(\d+)\)$/);return o&&(i=[this.codeFrame(t,parseInt(o[1],10),parseInt(o[2],10)+1,s)]),Error("Failed to instrument "+n+"\n"+i.join("\n"))},combineSourceMaps:function(e,t){if(!e)return t;if(!t)return e;var n=new u(t),r=new u(e),i=new h;n.eachMapping(function(e){if(null!=e.originalLine){var t=r.originalPositionFor({line:e.originalLine,column:e.originalColumn});null!=t.source&&i.addMapping({original:{line:t.line,column:t.column},generated:{line:e.generatedLine,column:e.generatedColumn},source:t.source,name:t.name||e.name})}});var s=[r,n];return s.forEach(function(e){e.sources.forEach(function(t){i._sources.add(t);var n=e.sourceContentFor(t);null!=n&&i.setSourceContent(t,n)})}),i._sourceRoot=e.sourceRoot,i._file=e.file,JSON.parse(i.toString())},mapTextPosition:function(e,t){var n;return e&&(t?(e.source=t.sources&&t.sources[0]||".",e.bias=2,n=t.generatedPositionFor(e)):n=e),n},textIndexPosition:function(e,t){var n=this.textLines(e,t);return{line:n.length,column:n[n.length-1].length}},mapTransformedRangeToOriginal:function(e,t){var n=function(e,t){var n=e.originalPositionFor({line:t.line,column:t.column-1});if(null===n.source)return null;var r=e.generatedPositionFor({source:n.source,line:n.line,column:n.column+1,bias:2});return null===r.line||e.originalPositionFor(r).line!==n.line?{source:n.source,line:n.line,column:1/0}:e.originalPositionFor(r)},r={start:{line:t[0],column:t[1]},end:{line:t[2],column:t[3]}},i=e.originalPositionFor(r.start),s=n(e,r.end);return i&&s&&i.source&&s.source?i.source!==s.source?null:null===i.line||null===i.column?null:null===s.line||null===s.column?null:(i.line===s.line&&i.column===s.column&&(s=e.originalPositionFor({line:r.end.line,column:r.end.column,bias:2}),s.column=s.column-1),[i.line,i.column,s.line,s.column]):null},mapOriginalRangeToTransformed:function(e,t){var n=o(t,4),r=n[0],i=n[1],s=n[2],a=n[3];if(!e)return[r,i,s,a];var l={line:r,column:i};l.source=e.sources&&e.sources[0]||".";var c=e.generatedPositionFor(l),u={line:s,column:a};u.source=e.sources&&e.sources[0]||".",u.bias=2;var h=e.generatedPositionFor(u);return c&&h&&null!==c.line&&null!==c.column&&null!==h.line&&null!==h.column?(h.line<c.line&&(h.line=c.line),h.column<c.column&&(h.column=1/0),[c.line,c.column,h.line,h.column]):void 0},textLines:function(e,t,n){return e=_.isUndefined(t)?e:e.substr(0,t),e.split(_.isUndefined(n)?/\r\n|\r|\n/:n)},verifyLocalOrigin:function(t,n){if(!t)return!0;var r=!1;try{var i=e("url").parse(t).hostname;r="localhost"===i||"0.0.0.0"===i||"127.0.0.1"===i||"::1"===i}catch(s){}return r||n||console.error("wallaby.js refused to accept connection from "+t),r},patchModule:function(t,n){var r=e("module").Module.prototype,i=r.require;r.require=function(e){return e===t?n(i.bind(this)):i.call(this,e)}},patchModulesCode:function(e,t){var n=l.readFileSync;l.readFileSync=function(r){var i=r.replace(/\\/g,"/"),s=n.apply(this,arguments);return e.some(function(e){if(e.files.some(function(e){return~i.indexOf(e)}))return s=s.toString(),e.replacements.forEach(function(n){var r=s;s=s.replace(n.from,n.to),s!==r||n.optional||console.warn(t+" ("+e.files.join(", ")+")")}),!0}),s}},requireModuleFrom:function(t,n){try{return e(a.join(t,"node_modules",n))}catch(r){var i=e("module"),s=new i(".",null);return s.filename=a.join(t,"wallaby.js"),s.paths=i._nodeModulePaths(t),i._load(n,s,!1)}},resolveModulePathFrom:function(t,n){var r=e("module"),i=new r(".",null);return i.filename=a.join(t,"wallaby.js"),i.paths=r._nodeModulePaths(t),r._resolveFilename(n,i,!1)},tryRequireModuleWithPathFrom:function(t,n,r){try{var i=e("module"),s=new i(".",null);s.filename=a.join(t,"wallaby.js"),s.paths=i._nodeModulePaths(t);var o=i._resolveFilename(n,s,!1),l=void 0;return l=process.env.WALLABY_INTEGRATION_TEST_RUN||process.env.WALLABY_UNIT_TEST_RUN?e(o):i._load(n,s,!1),{module:l&&l["default"]||l,moduleExports:l,path:o}}catch(c){if(r)throw c}},nodeModulesLookup:function(t,n){var r=e("module").Module,i=r.prototype,s=r._nodeModulePaths,o=i.require;r._nodeModulePaths=function(e){var n=s.call(this,e);return t(n,e,s,this),n},n&&(i.require=function(e){return o.call(this,n(e))})},nodeModulePaths:function(t){var n=e("module");return n._nodeModulePaths(t)},patchBabelResolve:function(e){var t=this.nodeModulePaths(e);this.patchModule("resolve",function(e){var n=e("resolve"),r=n.sync;return n.sync=function(e,n){return~e.indexOf("babel")&&n&&(arguments[1].paths=(n.paths||[]).concat(t)),r.apply(this,arguments)},n})},hasAnsi:function(e){return e&&"string"==typeof e&&e.match(f)},removeAnsi:function(e){return e&&"string"==typeof e?e.replace(f,""):e},copyToClipboard:function(t){var n=function(e){return e&&console.warn("May have failed to copy to clipboard. "+("linux"===process.platform?'Linux/Ubuntu environments require "xclip" to be installed. ':"")+(e&&e.message))};try{e("copy-paste").copy(t,n)}catch(r){n(r)}},testFileSelection:function(e,t,n,r){var i,s=!1,o=!1,a={};for(g.lastIndex=0;null!==(i=g.exec(e));){for(var l=i.index;l<i[0].length;l++)a[l]=1;s=s||t.test(i[0]),o=o||n.test(i[0])}if(!s&&r)for(m.lastIndex=0;null!==(i=m.exec(e));)if(!a[i.index]){s=!0;break}return{includedTestFile:s,excludedTestFile:o}},initServerOptions:function(t){var n=e("graceful-fs"),r=e("fs-extra");t.runnerResolver=function(t,n){return e("browser"===t?"electron"===n?"./electronRunner.js":"chrome"===n?"./chromeRunner.js":"./phantomRunner.js":"./nodeRunner.js")},t.processorPool=e("./processPool"),t.fileStructureCachePromise=function(e){return Q.nfcall(n.readFile,e).then(function(e){return Q.when(JSON.parse(e))})},t.fileStatPromise=function(e){return Q.nfcall(n.stat,e)},t.readFilePromise=function(e){return Q.nfcall(n.readFile,e)},t.writeFilePromise=function(e,t){return Q.nfcall(n.writeFile,e,t)},t.unlinkFilePromise=function(e){return Q.nfcall(n.unlink,e)},t.unlinkFileSync=function(e){return n.unlinkSync(e)},t.writeFileSync=function(e,t){return n.writeFileSync(e,t)},t.readFileSync=function(e){return n.readFileSync(e).toString("utf8")},t.fileExistsSync=function(e){return n.existsSync(e)},t.realpathSync=function(e){return n.realpathSync(e)},t.dirRemovePromise=function(e){return Q.nfcall(r.remove,e)},t.dirRemoveSync=function(e){return r.removeSync(e)},t.dirEnsurePromise=function(e){return Q.nfcall(r.ensureDir,e)},t.dirEnsureSync=function(e){return r.ensureDirSync(e)},t.nodeModulesLookup=this.nodeModulesLookup},codeFrame:function(e,t,n,i){function s(e,t,n){var i=r({column:0,line:-1},e.start),s=r(r({},i),e.end),o=n||{},a=o.linesAbove,l=void 0===a?2:a,c=o.linesBelow,u=void 0===c?3:c,h=i.line,d=i.column,p=s.line,f=s.column,_=Math.max(h-(l+1),0),g=Math.min(t.length,p+u);h===-1&&(_=0),p===-1&&(g=t.length);var m=p-h,v={};if(m)for(var y=0;y<=m;y++){var b=y+h;if(d)if(0===y){var T=t[b-1].length;v[b]=[d,T-d]}else if(y===m)v[b]=[0,f];else{var T=t[b-y].length;v[b]=[0,T]}else v[b]=!0}else d===f?d?v[h]=[d,0]:v[h]=!0:v[h]=[d,f-d];return{start:_,end:g,markerLines:v}}var o=this.textLines(e),a={start:{column:n,line:t}},l=s(a,o),c=l.start,u=l.end,h=l.markerLines,d=a.start&&"number"==typeof a.start.column,p=String(u).length,f=o.slice(c,u).map(function(e,t){var n=c+1+t,r=(" "+n).slice(-p),s=" "+r+" | ",o=h[n],a=!h[n+1];if(o){var l="";if(Array.isArray(o)){var u=e.slice(0,Math.max(o[0]-1,0)).replace(/[^\t]/g," "),d=o[1]||1;l=["\n ",s.replace(/\d/g," "),u,"^".repeat(d)].join(""),a&&i&&(l+=" "+i)}return[">",s,e,l].join("")}return" "+s+e}).join("\n");return d||(f=""+" ".repeat(p+1)+i+"\n"+f),f},loadJest:function(t,n,r){return i(this,void 0,void 0,function(){var i,o,l,c,u,h,d,p,f,_,g,m,v,y,b,T=this;return s(this,function(s){switch(s.label){case 0:o=!1;try{l=e(a.resolve(t,"package.json")),c=l&&l.scripts,u=l&&l.devDependencies||{},h=l&&l.dependencies||{},o=!!u.jest||!!h["react-scripts"]||!!h.jest,(c&&c.test&&c.test.indexOf("react-scripts")!==-1||!u||!u.jest)&&(i=this.tryRequireModuleWithPathFrom(t,"react-scripts/scripts/utils/createJestConfig"))}catch(k){i=void 0}if(n=n&&(a.isAbsolute(n)?n:a.resolve(a.join(t,n))),d=n?this.tryRequireModuleWithPathFrom(n,"jest"):i?this.tryRequireModuleWithPathFrom(i.path,"jest"):this.tryRequireModuleWithPathFrom(t,"jest"),f=d?d.path:t,g=this.tryRequireModuleWithPathFrom(f,"jest-cli"),!g)return[3,5];if(m=g.module.getVersion?function(){return g.module.getVersion()}:d.module.getVersion?function(){return d.module.getVersion()}:void 0,!m)throw new Error("Cannot find compatible jest-cli module.");v="x.x.x",y=0;try{v=m(),y=parseInt(v.split(".")[0])}catch(k){throw new Error("Cannot detect/parse jest-cli module version: "+k.message+".")}if(y<24)throw new Error("Only Jest v24.x or higher is supported, but found v"+v+" at '"+g.path+"'.");if(p=this.tryRequireModuleWithPathFrom(g.path,"jest-config"),!p)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),r=r&&(a.isAbsolute(r)?r:a.resolve(a.join(t,r))),[4,p.module.readConfigs(r?{config:r}:i?{config:JSON.stringify(i.module(function(e){return a.resolve(i.path,"../../..",e)}))}:{},[t])];case 2:return _=s.sent(),_.globalConfig=Object.assign({},_.globalConfig),_.configs=(_.configs||[]).filter(function(e){return"jest-runner"===e.runner||~T.normalizePath(e.runner||"").indexOf("node_modules/jest-runner/")||"jest-runner-groups"===e.runner||~T.normalizePath(e.runner||"").indexOf("node_modules/jest-runner-groups/")}).map(function(e){return Object.assign({},e)}),[3,4];case 3:throw b=s.sent(),new Error("Failed to read Jest configuration from '"+t+"': "+(b.message?b.message:"unknown."));case 4:return[3,6];case 5:throw new Error("Module jest-cli is not found in '"+t+"'.");case 6:if(!_)throw new Error("Failed to read Jest configuration from '"+t+"'.");if(!_.configs.length)throw new Error("Can not find any Jest runner configurations in '"+t+"'.");return[2,{jestConfig:_,jestCLI:g,jestConfigLoader:p,isDirectDependency:o}]}})})},serializeRegExp:function(e){if(_.isRegExp(e))return"__REGEXP "+e.toString();if(_.isString(e))return e;throw new Error("Must pass a string or a regular expression")},deserializeRegExp:function(e){if(0===e.indexOf("__REGEXP ")){var t=e.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/);return new RegExp(t[1],t[2]||"")}return e},isJavaScript:T,isTypeScript:k,isVue:w,isCoffeeScript:S,isCoverable:function(e,t,n){return T(e,n)||k(e)||w(e)||S(e,t)},quickHash:function(e){var t,n,r,i=0;if(e.length>0)for(t=0,r=e.length;t<r;t++)n=e.charCodeAt(t),i=(i<<5)-i+n,i|=0;return i},isWsl:function(){var t=e("os");if("linux"!==process.platform)return!1;if(t.release().toLowerCase().includes("microsoft"))return!0;try{return l.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")}catch(n){return!1}},wslHostIpAddress:function(){var e=l.readFileSync("/etc/resolv.conf").toString().split("\n").map(function(e){return e.split(" ")}).filter(function(e){return"nameserver"===e[0]}).map(function(e){return e.length>1&&e[1]});return 1===e.length?e[0]:"127.0.0.1"}}},{"./chromeRunner.js":3,"./electronRunner.js":5,"./nodeRunner.js":12,"./phantomRunner.js":13,"./processPool":14,"copy-paste":void 0,fs:void 0,"fs-extra":void 0,"graceful-fs":void 0,micromatch:void 0,minimatch:void 0,module:void 0,os:void 0,path:void 0,"source-map":void 0,url:void 0}]},{},[1]);